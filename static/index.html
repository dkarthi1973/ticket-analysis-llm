<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enterprise Ticket Analysis System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .loading-spinner {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: #4F46E5;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .ticket-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .ticket-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .priority-low {
      background-color: #D1FAE5;
      color: #065F46;
    }

    .priority-medium {
      background-color: #FEF3C7;
      color: #92400E;
    }

    .priority-high {
      background-color: #FEE2E2;
      color: #B91C1C;
    }

    .priority-critical {
      background-color: #7F1D1D;
      color: #FEE2E2;
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #1F2937;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    /* Dashboard chart styles */
    .chart-container {
      height: 250px;
      width: 100%;
    }

    .sentiment-meter {
      width: 100%;
      height: 20px;
      background-color: #E5E7EB;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .sentiment-meter-fill {
      height: 100%;
      background: linear-gradient(to right, #EF4444, #F59E0B, #10B981);
      transition: width 0.5s ease;
    }

    .sentiment-marker {
      position: absolute;
      width: 4px;
      height: 24px;
      background-color: #374151;
      top: -2px;
      transform: translateX(-50%);
    }

    /* Custom tab styles */
    .tab-active {
      border-bottom: 2px solid #4F46E5;
      color: #4F46E5;
    }

    /* Responsive tables */
    @media (max-width: 768px) {
      .responsive-table {
        display: block;
        width: 100%;
        overflow-x: auto;
      }
    }

    /* Form validation styles */
    .input-error {
      border-color: #EF4444;
    }

    .error-message {
      color: #EF4444;
      font-size: 0.75rem;
      margin-top: 0.25rem;
    }
    
    /* Status indicator styles */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-active {
      background-color: #10B981;
      box-shadow: 0 0 5px #10B981;
    }
    
    .status-inactive {
      background-color: #6B7280;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <!-- Main navigation -->
  <nav class="bg-indigo-600 shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
          <span class="ml-2 text-white font-semibold text-xl">Enterprise Ticket Analysis System</span>
        </div>
        <div class="flex items-center">
          <div class="flex items-center mr-4">
            <div class="status-indicator status-active" id="api-status-indicator"></div>
            <span class="text-white text-sm" id="api-status">API Connected</span>
          </div>
          <div class="ml-4 flex items-center md:ml-6">
            <button id="settings-button" class="p-1 rounded-full text-gray-200 hover:text-white focus:outline-none">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Settings modal -->
  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-900">API Settings</h2>
        <button id="close-settings" class="text-gray-500 hover:text-gray-700">
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <form id="settings-form" class="space-y-4">
        <div>
          <label for="model-select" class="block text-sm font-medium text-gray-700">LLM Model</label>
          <select id="model-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            <option value="loading">Loading available models...</option>
          </select>
        </div>
        <div>
          <label for="ollama-url" class="block text-sm font-medium text-gray-700">Ollama API URL</label>
          <input type="text" id="ollama-url" name="ollama-url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="http://localhost:11434">
          <p class="mt-1 text-sm text-gray-500">Example: http://localhost:11434</p>
        </div>
        <div class="flex justify-end">
          <button type="button" id="test-connection" class="mr-2 bg-gray-100 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Test Connection
          </button>
          <button type="submit" class="bg-indigo-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Save Settings
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Main content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Tabs navigation -->
    <div class="border-b border-gray-200 mb-6">
      <nav class="flex -mb-px space-x-8">
        <a href="#" id="tab-dashboard" class="tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
          Dashboard
        </a>
        <a href="#" id="tab-single-analysis" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Single Ticket Analysis
        </a>
        <a href="#" id="tab-bulk-analysis" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Bulk Analysis
        </a>
        <a href="#" id="tab-training" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Classifier Training
        </a>
      </nav>
    </div>

    <!-- Dashboard tab content -->
    <div id="dashboard-content" class="tab-content">
      <!-- Stats cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Total Tickets</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="total-tickets">0</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Avg. Sentiment Score</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="avg-sentiment">0.0</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Avg. Processing Time</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="avg-time">0.0s</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Top Category</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="top-category">-</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Ticket Categories</h2>
            <div class="chart-container" id="category-chart-container">
              <canvas id="category-chart"></canvas>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Ticket Priorities</h2>
            <div class="chart-container" id="priority-chart-container">
              <canvas id="priority-chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent tickets -->
      <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">Recent Ticket Analysis</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 responsive-table">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentiment</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="recent-tickets-table">
                <tr>
                  <td colspan="6" class="px-6 py-4 text-center text-gray-500">No recent tickets</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Single Ticket Analysis tab content -->
    <div id="single-analysis-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Submit Ticket for Analysis</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Enter ticket details for AI-powered analysis</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="single-ticket-form" class="space-y-6">
            <div>
              <label for="ticket-subject" class="block text-sm font-medium text-gray-700">Subject</label>
              <div class="mt-1">
                <input type="text" name="ticket-subject" id="ticket-subject" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter ticket subject">
                <div class="error-message hidden" id="ticket-subject-error">Please enter a subject</div>
              </div>
            </div>

            <div>
              <label for="ticket-description" class="block text-sm font-medium text-gray-700">Description</label>
              <div class="mt-1">
                <textarea id="ticket-description" name="ticket-description" rows="5" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter ticket description"></textarea>
                <div class="error-message hidden" id="ticket-description-error">Please enter a description</div>
              </div>
            </div>

            <div class="flex items-center">
              <input id="quick-analysis" name="quick-analysis" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
              <label for="quick-analysis" class="ml-2 block text-sm text-gray-900">Use quick analysis mode (faster but less detailed)</label>
            </div>

            <div class="flex justify-end">
              <button type="submit" class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Analyze Ticket
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Analysis Results Section (initially hidden) -->
      <div id="single-analysis-results" class="hidden">
        <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
          <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
            <div>
              <h2 class="text-lg leading-6 font-medium text-gray-900">Analysis Results</h2>
              <p class="mt-1 max-w-2xl text-sm text-gray-500" id="analysis-method">Full AI analysis</p>
            </div>
            <div>
              <button id="export-analysis" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Export
              </button>
            </div>
          </div>

          <div class="border-t border-gray-200">
            <dl>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Category</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="result-category">-</dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Priority</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <span id="result-priority-badge" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">-</span>
                </dd>
              </div>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Sentiment Score</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div class="sentiment-meter">
                    <div id="sentiment-meter-fill" class="sentiment-meter-fill" style="width: 50%;"></div>
                    <div id="sentiment-marker" class="sentiment-marker" style="left: 50%;"></div>
                  </div>
                  <div class="flex justify-between mt-1">
                    <span class="text-xs text-red-600">Negative (-1.0)</span>
                    <span class="text-xs text-green-600">Positive (1.0)</span>
                  </div>
                  <div class="text-center text-xs mt-1" id="sentiment-value">0.0</div>
                </dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Summary</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="result-summary">-</dd>
              </div>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Suggested Response</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div id="result-response" class="prose max-w-none">-</div>
                  <div class="mt-2">
                    <button id="copy-response" class="inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                      </svg>
                      Copy Response
                    </button>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Bulk Analysis tab content -->
    <div id="bulk-analysis-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Bulk Ticket Upload</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Upload a CSV file containing multiple tickets</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="csv-upload-form" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700">CSV File</label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  <div class="flex text-sm text-gray-600">
                    <label for="csv-file" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                      <span>Upload a file</span>
                      <input id="csv-file" name="csv-file" type="file" accept=".csv" class="sr-only">
                    </label>
                    <p class="pl-1">or drag and drop</p>
                  </div>
                  <p class="text-xs text-gray-500">CSV up to 10MB</p>
                </div>
              </div>
              <div class="mt-2 hidden" id="file-selected">
                <div class="bg-gray-50 px-3 py-2 rounded-md flex items-center justify-between">
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span id="selected-filename" class="text-sm text-gray-600">filename.csv</span>
                  </div>
                  <button type="button" id="remove-file" class="text-gray-400 hover:text-gray-500">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">CSV Mapping</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="subject-column" class="block text-sm font-medium text-gray-700">Subject Column</label>
                  <select id="subject-column" name="subject-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="subject" selected>subject</option>
                  </select>
                </div>
                
                <div>
                  <label for="description-column" class="block text-sm font-medium text-gray-700">Description Column</label>
                  <select id="description-column" name="description-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="description" selected>description</option>
                  </select>
                </div>
                
                <div>
                  <label for="category-column" class="block text-sm font-medium text-gray-700">Category Column (optional)</label>
                  <select id="category-column" name="category-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">None</option>
                    <option value="category">category</option>
                  </select>
                </div>
                
                <div>
                  <label for="priority-column" class="block text-sm font-medium text-gray-700">Priority Column (optional)</label>
                  <select id="priority-column" name="priority-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">None</option>
                    <option value="priority">priority</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="flex items-center">
              <input id="bulk-quick-analysis" name="bulk-quick-analysis" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
              <label for="bulk-quick-analysis" class="ml-2 block text-sm text-gray-900">Use quick analysis mode (recommended for bulk processing)</label>
            </div>

            <div class="flex justify-end">
              <button type="button" id="preview-csv" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Preview Data
              </button>
              <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Process Tickets
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- CSV Preview Modal -->
      <div id="csv-preview-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full p-6 max-h-screen overflow-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900">CSV Preview</h2>
            <button id="close-csv-preview" class="text-gray-500 hover:text-gray-700">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr id="csv-preview-headers">
                  <!-- Headers will be populated dynamically -->
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="csv-preview-rows">
                <!-- Rows will be populated dynamically -->
              </tbody>
            </table>
          </div>
          <div class="mt-4 flex justify-end">
            <button id="confirm-csv-mapping" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Confirm Mapping
            </button>
          </div>
        </div>
      </div>

      <!-- Processing Status Section -->
      <div id="bulk-processing-status" class="hidden bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Processing Status</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500" id="processing-status-message">Analyzing tickets...</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <div class="relative pt-1">
            <div class="flex mb-2 items-center justify-between">
              <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-indigo-600 bg-indigo-200" id="progress-percentage">
                  0%
                </span>
              </div>
              <div class="text-right">
                <span class="text-xs font-semibold inline-block text-indigo-600" id="progress-count">
                  0/0 tickets
                </span>
              </div>
            </div>
            <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-indigo-200">
              <div id="progress-bar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-500" id="estimated-time">Estimated completion time: Calculating...</p>
          </div>
        </div>
      </div>

      <!-- Bulk Analysis Results Section -->
      <div id="bulk-analysis-results" class="hidden bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
          <div>
            <h2 class="text-lg leading-6 font-medium text-gray-900">Analysis Results</h2>
            <p class="mt-1 max-w-2xl text-sm text-gray-500" id="bulk-results-summary">0 tickets analyzed</p>
          </div>
          <div class="flex">
            <button id="export-bulk-results" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 mr-2">
              <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              Export CSV
            </button>
            <button id="view-dashboard-from-bulk" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              View Dashboard
            </button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 responsive-table">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentiment</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="bulk-results-table">
              <!-- Results will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ticket Detail Modal -->
      <div id="ticket-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full p-6 max-h-screen overflow-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900" id="detail-modal-title">Ticket Details</h2>
            <button id="close-ticket-detail" class="text-gray-500 hover:text-gray-700">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div>
            <dl class="divide-y divide-gray-200">
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Subject</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-subject">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Description</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-description">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Category</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-category">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Priority</dt>
                <dd class="mt-1 sm:mt-0 sm:col-span-2">
                  <span id="detail-priority-badge" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">-</span>
                </dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Sentiment</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-sentiment">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Summary</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-summary">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Suggested Response</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div id="detail-response" class="prose max-w-none">-</div>
                  <div class="mt-2">
                    <button id="copy-detail-response" class="inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                      </svg>
                      Copy Response
                    </button>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Classifier Training tab content -->
    <div id="training-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Train Category Classifier</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Upload categorized tickets to train the system</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="training-form" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700">Training Data</label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  <div class="flex text-sm text-gray-600">
                    <label for="training-csv-file" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                      <span>Upload a file</span>
                      <input id="training-csv-file" name="training-csv-file" type="file" accept=".csv" class="sr-only">
                    </label>
                    <p class="pl-1">or drag and drop</p>
                  </div>
                  <p class="text-xs text-gray-500">CSV with categorized tickets</p>
                </div>
              </div>
              <div class="mt-2 hidden" id="training-file-selected">
                <div class="bg-gray-50 px-3 py-2 rounded-md flex items-center justify-between">
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span id="training-selected-filename" class="text-sm text-gray-600">filename.csv</span>
                  </div>
                  <button type="button" id="training-remove-file" class="text-gray-400 hover:text-gray-500">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">CSV Mapping</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="training-subject-column" class="block text-sm font-medium text-gray-700">Subject Column</label>
                  <select id="training-subject-column" name="training-subject-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="subject" selected>subject</option>
                  </select>
                </div>
                
                <div>
                  <label for="training-description-column" class="block text-sm font-medium text-gray-700">Description Column</label>
                  <select id="training-description-column" name="training-description-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="description" selected>description</option>
                  </select>
                </div>
                
                <div>
                  <label for="training-category-column" class="block text-sm font-medium text-gray-700">Category Column</label>
                  <select id="training-category-column" name="training-category-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="category" selected>category</option>
                  </select>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">Or Add Categories Manually</h3>
              <div class="mt-2">
                <div class="flex items-center">
                  <input type="text" id="new-category" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter category name">
                  <button type="button" id="add-category" class="ml-2 inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                  </button>
                </div>
                <div class="mt-2 flex flex-wrap" id="categories-container">
                  <!-- Categories will be added here dynamically -->
                </div>
              </div>
            </div>

            <div class="flex justify-end">
              <button type="button" id="preview-training-data" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Preview Data
              </button>
              <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Train Classifier
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Training Status Card -->
      <div id="training-status" class="hidden bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Training Status</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500" id="training-status-message">Training in progress...</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <div id="training-in-progress" class="flex justify-center">
            <div class="loading-spinner"></div>
          </div>
          <div id="training-complete" class="hidden">
            <div class="bg-green-100 rounded-md p-4">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-green-800">Training complete</h3>
                                      <div class="mt-2 text-sm text-green-700">
                      <p>The classifier has been successfully trained with <span id="trained-samples-count">0</span> samples across <span id="trained-categories-count">0</span> categories.</p>
                      <ul class="mt-1 list-disc pl-5 space-y-1" id="trained-categories-list">
                        <!-- Categories will be added dynamically -->
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification component -->
  <div id="notification" class="fixed inset-0 flex items-end justify-center px-4 py-6 pointer-events-none sm:p-6 sm:items-start sm:justify-end z-50 hidden">
    <div class="max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto overflow-hidden">
      <div class="p-4">
        <div class="flex items-start">
          <div id="notification-icon" class="flex-shrink-0">
            <!-- Icon will be added dynamically based on notification type -->
          </div>
          <div class="ml-3 w-0 flex-1 pt-0.5">
            <p class="text-sm font-medium text-gray-900" id="notification-title">Notification Title</p>
            <p class="mt-1 text-sm text-gray-500" id="notification-message">Notification message here.</p>
          </div>
          <div class="ml-4 flex-shrink-0 flex">
            <button id="close-notification" class="bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              <span class="sr-only">Close</span>
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>

  <!-- Application JavaScript -->
  <script>
    // Global state
    const state = {
      apiBaseUrl: 'http://localhost:8000',
      tickets: [],
      analyzedTickets: [],
      categories: [],
      bulkResults: [],
      currentTicket: null,
      charts: {
        categoryChart: null,
        priorityChart: null,
      },
      processing: {
        isProcessing: false,
        total: 0,
        processed: 0,
        lastUpdate: null,
        estimatedCompletion: null
      },
      modelInfo: {
        modelName: '',
        ollamaUrl: '',
        availableModels: [],
        hasClassifier: false
      }
    };

    // DOM Elements
    const elements = {
      // Tab navigation
      tabDashboard: document.getElementById('tab-dashboard'),
      tabSingleAnalysis: document.getElementById('tab-single-analysis'),
      tabBulkAnalysis: document.getElementById('tab-bulk-analysis'),
      tabTraining: document.getElementById('tab-training'),
      
      // Tab content containers
      dashboardContent: document.getElementById('dashboard-content'),
      singleAnalysisContent: document.getElementById('single-analysis-content'),
      bulkAnalysisContent: document.getElementById('bulk-analysis-content'),
      trainingContent: document.getElementById('training-content'),
      
      // Dashboard elements
      totalTickets: document.getElementById('total-tickets'),
      avgSentiment: document.getElementById('avg-sentiment'),
      avgTime: document.getElementById('avg-time'),
      topCategory: document.getElementById('top-category'),
      recentTicketsTable: document.getElementById('recent-tickets-table'),
      
      // Single analysis elements
      singleTicketForm: document.getElementById('single-ticket-form'),
      ticketSubject: document.getElementById('ticket-subject'),
      ticketDescription: document.getElementById('ticket-description'),
      quickAnalysis: document.getElementById('quick-analysis'),
      singleAnalysisResults: document.getElementById('single-analysis-results'),
      resultCategory: document.getElementById('result-category'),
      resultPriorityBadge: document.getElementById('result-priority-badge'),
      sentimentMeterFill: document.getElementById('sentiment-meter-fill'),
      sentimentMarker: document.getElementById('sentiment-marker'),
      sentimentValue: document.getElementById('sentiment-value'),
      resultSummary: document.getElementById('result-summary'),
      resultResponse: document.getElementById('result-response'),
      copyResponse: document.getElementById('copy-response'),
      analysisMethod: document.getElementById('analysis-method'),
      exportAnalysis: document.getElementById('export-analysis'),
      
      // Bulk analysis elements
      csvUploadForm: document.getElementById('csv-upload-form'),
      csvFile: document.getElementById('csv-file'),
      fileSelected: document.getElementById('file-selected'),
      selectedFilename: document.getElementById('selected-filename'),
      removeFile: document.getElementById('remove-file'),
      subjectColumn: document.getElementById('subject-column'),
      descriptionColumn: document.getElementById('description-column'),
      categoryColumn: document.getElementById('category-column'),
      priorityColumn: document.getElementById('priority-column'),
      bulkQuickAnalysis: document.getElementById('bulk-quick-analysis'),
      previewCsv: document.getElementById('preview-csv'),
      bulkProcessingStatus: document.getElementById('bulk-processing-status'),
      progressPercentage: document.getElementById('progress-percentage'),
      progressCount: document.getElementById('progress-count'),
      progressBar: document.getElementById('progress-bar'),
      estimatedTime: document.getElementById('estimated-time'),
      processingStatusMessage: document.getElementById('processing-status-message'),
      bulkAnalysisResults: document.getElementById('bulk-analysis-results'),
      bulkResultsSummary: document.getElementById('bulk-results-summary'),
      bulkResultsTable: document.getElementById('bulk-results-table'),
      exportBulkResults: document.getElementById('export-bulk-results'),
      viewDashboardFromBulk: document.getElementById('view-dashboard-from-bulk'),
      
      // CSV Preview Modal
      csvPreviewModal: document.getElementById('csv-preview-modal'),
      closeCsvPreview: document.getElementById('close-csv-preview'),
      csvPreviewHeaders: document.getElementById('csv-preview-headers'),
      csvPreviewRows: document.getElementById('csv-preview-rows'),
      confirmCsvMapping: document.getElementById('confirm-csv-mapping'),
      
      // Ticket Detail Modal
      ticketDetailModal: document.getElementById('ticket-detail-modal'),
      closeTicketDetail: document.getElementById('close-ticket-detail'),
      detailModalTitle: document.getElementById('detail-modal-title'),
      detailSubject: document.getElementById('detail-subject'),
      detailDescription: document.getElementById('detail-description'),
      detailCategory: document.getElementById('detail-category'),
      detailPriorityBadge: document.getElementById('detail-priority-badge'),
      detailSentiment: document.getElementById('detail-sentiment'),
      detailSummary: document.getElementById('detail-summary'),
      detailResponse: document.getElementById('detail-response'),
      copyDetailResponse: document.getElementById('copy-detail-response'),
      
      // Training elements
      trainingForm: document.getElementById('training-form'),
      trainingCsvFile: document.getElementById('training-csv-file'),
      trainingFileSelected: document.getElementById('training-file-selected'),
      trainingSelectedFilename: document.getElementById('training-selected-filename'),
      trainingRemoveFile: document.getElementById('training-remove-file'),
      trainingSubjectColumn: document.getElementById('training-subject-column'),
      trainingDescriptionColumn: document.getElementById('training-description-column'),
      trainingCategoryColumn: document.getElementById('training-category-column'),
      newCategory: document.getElementById('new-category'),
      addCategory: document.getElementById('add-category'),
      categoriesContainer: document.getElementById('categories-container'),
      previewTrainingData: document.getElementById('preview-training-data'),
      trainingStatus: document.getElementById('training-status'),
      trainingStatusMessage: document.getElementById('training-status-message'),
      trainingInProgress: document.getElementById('training-in-progress'),
      trainingComplete: document.getElementById('training-complete'),
      trainedSamplesCount: document.getElementById('trained-samples-count'),
      trainedCategoriesCount: document.getElementById('trained-categories-count'),
      trainedCategoriesList: document.getElementById('trained-categories-list'),
      
      // Settings modal
      settingsButton: document.getElementById('settings-button'),
      settingsModal: document.getElementById('settings-modal'),
      closeSettings: document.getElementById('close-settings'),
      settingsForm: document.getElementById('settings-form'),
      modelSelect: document.getElementById('model-select'),
      ollamaUrl: document.getElementById('ollama-url'),
      testConnection: document.getElementById('test-connection'),
      
      // API status
      apiStatus: document.getElementById('api-status'),
      apiStatusIndicator: document.getElementById('api-status-indicator'),
      
      // Notification
      notification: document.getElementById('notification'),
      notificationIcon: document.getElementById('notification-icon'),
      notificationTitle: document.getElementById('notification-title'),
      notificationMessage: document.getElementById('notification-message'),
      closeNotification: document.getElementById('close-notification')
    };

    // Utility functions
    const utils = {
      // Format sentiment score
      formatSentiment: (score) => {
        return parseFloat(score).toFixed(2);
      },
      
      // Set priority badge color and text
      setPriorityBadge: (element, priority) => {
        element.textContent = priority.charAt(0).toUpperCase() + priority.slice(1);
        element.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full';
        
        switch (priority.toLowerCase()) {
          case 'low':
            element.classList.add('priority-low');
            break;
          case 'medium':
            element.classList.add('priority-medium');
            break;
          case 'high':
            element.classList.add('priority-high');
            break;
          case 'critical':
            element.classList.add('priority-critical');
            break;
          default:
            element.classList.add('bg-gray-100', 'text-gray-800');
        }
      },
      
      // Set sentiment meter display
      setSentimentMeter: (fillElement, markerElement, valueElement, score) => {
        // Convert score from -1...1 to 0...100
        const percentage = ((parseFloat(score) + 1) / 2) * 100;
        fillElement.style.width = `${percentage}%`;
        markerElement.style.left = `${percentage}%`;
        valueElement.textContent = utils.formatSentiment(score);
      },
      
      // Show notification
      showNotification: (type, title, message, duration = 4000) => {
        // Set icon based on notification type
        let iconSvg = '';
        switch (type) {
          case 'success':
            iconSvg = '<svg class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            break;
          case 'error':
            iconSvg = '<svg class="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            break;
          case 'warning':
            iconSvg = '<svg class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
            break;
          case 'info':
          default:
            iconSvg = '<svg class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
        }
        
        elements.notificationIcon.innerHTML = iconSvg;
        elements.notificationTitle.textContent = title;
        elements.notificationMessage.textContent = message;
        elements.notification.classList.remove('hidden');
        
        // Auto-hide after duration
        setTimeout(() => {
          elements.notification.classList.add('hidden');
        }, duration);
      },
      
      // Copy text to clipboard
      copyToClipboard: async (text) => {
        try {
          await navigator.clipboard.writeText(text);
          utils.showNotification('success', 'Copied!', 'Text copied to clipboard');
        } catch (err) {
          utils.showNotification('error', 'Copy Failed', 'Failed to copy text to clipboard');
          console.error('Failed to copy text: ', err);
        }
      },
      
      // Format date
      formatDate: (dateString) => {
        const date = new Date(dateString);
        return date.toLocaleString();
      },
      
      // Export JSON to file
      exportJson: (data, filename) => {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      },
      
      // Export data to CSV
      exportToCsv: (data, filename) => {
        // Convert data to CSV format
        const headers = Object.keys(data[0]).join(',');
        const rows = data.map(item => {
          return Object.values(item).map(value => {
            // Handle strings with commas by enclosing in quotes
            if (typeof value === 'string' && value.includes(',')) {
              return `"${value}"`;
            }
            return value;
          }).join(',');
        });
        
        const csv = [headers, ...rows].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      },
      
      // Validate form inputs
      validateForm: (form) => {
        let isValid = true;
        
        // Reset all error messages
        form.querySelectorAll('.error-message').forEach(element => {
          element.classList.add('hidden');
        });
        
        // Check required fields
        form.querySelectorAll('[required]').forEach(input => {
          if (!input.value.trim()) {
            const errorElement = document.getElementById(`${input.id}-error`);
            if (errorElement) {
              errorElement.classList.remove('hidden');
              input.classList.add('input-error');
            }
            isValid = false;
          } else {
            input.classList.remove('input-error');
          }
        });
        
        return isValid;
      },
      
      // Update API connection status display
      updateApiStatus: (isConnected, message = null) => {
        if (isConnected) {
          elements.apiStatus.textContent = message || 'API Connected';
          elements.apiStatusIndicator.classList.remove('status-inactive');
          elements.apiStatusIndicator.classList.add('status-active');
        } else {
          elements.apiStatus.textContent = message || 'API Disconnected';
          elements.apiStatusIndicator.classList.remove('status-active');
          elements.apiStatusIndicator.classList.add('status-inactive');
        }
      },
      
      // Get category distribution from tickets
      getCategoryDistribution: (tickets) => {
        const categories = {};
        tickets.forEach(ticket => {
          const category = ticket.category || 'Uncategorized';
          categories[category] = (categories[category] || 0) + 1;
        });
        return categories;
      },
      
      // Get priority distribution from tickets
      getPriorityDistribution: (tickets) => {
        const priorities = {
          low: 0,
          medium: 0,
          high: 0,
          critical: 0
        };
        
        tickets.forEach(ticket => {
          const priority = ticket.priority?.toLowerCase() || 'medium';
          if (priorities.hasOwnProperty(priority)) {
            priorities[priority]++;
          } else {
            priorities.medium++;
          }
        });
        
        return priorities;
      }
    };

    // API Service
    const apiService = {
      // Check API connection
      checkConnection: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/`);
          if (response.ok) {
            const data = await response.json();
            utils.updateApiStatus(true);
            return data;
          } else {
            utils.updateApiStatus(false);
            throw new Error('Failed to connect to API');
          }
        } catch (error) {
          utils.updateApiStatus(false, 'API Connection Failed');
          console.error('API connection error:', error);
          throw error;
        }
      },
      
      // Get model information
      getModelInfo: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/model_info`);
          if (response.ok) {
            const data = await response.json();
            state.modelInfo = data;
            return data;
          } else {
            throw new Error('Failed to get model information');
          }
        } catch (error) {
          console.error('Error getting model info:', error);
          utils.showNotification('error', 'Error', 'Failed to get model information');
          throw error;
        }
      },
      
      // Analyze a single ticket
      analyzeTicket: async (ticket, quick = false) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/analyze_ticket?quick=${quick}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(ticket),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.analyzedTickets.unshift(data);
            
            // Keep only the latest 20 tickets in history
            if (state.analyzedTickets.length > 20) {
              state.analyzedTickets = state.analyzedTickets.slice(0, 20);
            }
            
            return data;
          } else {
            throw new Error('Failed to analyze ticket');
          }
        } catch (error) {
          console.error('Error analyzing ticket:', error);
          utils.showNotification('error', 'Analysis Failed', `Failed to analyze ticket: ${error.message}`);
          throw error;
        }
      },
      
      // Upload and process CSV file
      uploadCsv: async (formData) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/upload_csv`, {
            method: 'POST',
            body: formData,
          });
          
          if (response.ok) {
            const data = await response.json();
            return data;
          } else {
            throw new Error('Failed to upload CSV file');
          }
        } catch (error) {
          console.error('Error uploading CSV:', error);
          utils.showNotification('error', 'Upload Failed', `Failed to upload CSV: ${error.message}`);
          throw error;
        }
      },
      
      // Process tickets in bulk
      bulkAnalyze: async (tickets, quick = true) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/bulk_analyze?quick=${quick}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(tickets),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.bulkResults = data;
            return data;
          } else {
            throw new Error('Failed to process tickets in bulk');
          }
        } catch (error) {
          console.error('Error in bulk analysis:', error);
          utils.showNotification('error', 'Bulk Analysis Failed', `Failed to analyze tickets: ${error.message}`);
          throw error;
        }
      },
      
      // Get processing status
      getProcessingStatus: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/processing_status`);
          if (response.ok) {
            const data = await response.json();
            state.processing = data;
            return data;
          } else {
            throw new Error('Failed to get processing status');
          }
        } catch (error) {
          console.error('Error getting processing status:', error);
          return state.processing;
        }
      },
      
      // Train classifier
      trainClassifier: async (dataset) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/train_classifier`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(dataset),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.categories = data.categories;
            return data;
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to train classifier');
          }
        } catch (error) {
          console.error('Error training classifier:', error);
          utils.showNotification('error', 'Training Failed', `Failed to train classifier: ${error.message}`);
          throw error;
        }
      }
    };

    // UI Controllers
    const uiControllers = {
      // Tab navigation controller
      initTabNavigation: () => {
        const tabs = [
          { tab: elements.tabDashboard, content: elements.dashboardContent },
          { tab: elements.tabSingleAnalysis, content: elements.singleAnalysisContent },
          { tab: elements.tabBulkAnalysis, content: elements.bulkAnalysisContent },
          { tab: elements.tabTraining, content: elements.trainingContent }
        ];
        
        tabs.forEach(({ tab, content }) => {
          tab.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Hide all tab contents
            tabs.forEach(t => {
              t.content.classList.add('hidden');
              t.tab.classList.remove('tab-active');
              t.tab.classList.add('text-gray-500', 'hover:text-gray-700', 'border-transparent');
            });
            
            // Show selected tab content
            content.classList.remove('hidden');
            tab.classList.add('tab-active');
            tab.classList.remove('text-gray-500', 'hover:text-gray-700', 'border-transparent');
            
            // Specific actions for tabs
            if (tab === elements.tabDashboard) {
              uiControllers.refreshDashboard();
            }
          });
        });
      },
      
      // Dashboard controller
      refreshDashboard: () => {
        // Update statistics
        elements.totalTickets.textContent = state.analyzedTickets.length;
        
        // Calculate average sentiment
        if (state.analyzedTickets.length > 0) {
          const sumSentiment = state.analyzedTickets.reduce((sum, ticket) => sum + ticket.sentiment, 0);
          const avgSentiment = sumSentiment / state.analyzedTickets.length;
          elements.avgSentiment.textContent = utils.formatSentiment(avgSentiment);
          
          // Find top category
          const categoryDistribution = utils.getCategoryDistribution(state.analyzedTickets);
          let topCategoryName = 'None';
          let topCategoryCount = 0;
          
          Object.entries(categoryDistribution).forEach(([category, count]) => {
            if (count > topCategoryCount) {
              topCategoryName = category;
              topCategoryCount = count;
            }
          });
          
          elements.topCategory.textContent = topCategoryName;
          
          // Update charts
          uiControllers.updateDashboardCharts();
          
          // Update recent tickets table
          uiControllers.updateRecentTicketsTable();
        }
      },
      
      // Update dashboard charts
      updateDashboardCharts: () => {
        // Category distribution chart
        const categoryDistribution = utils.getCategoryDistribution(state.analyzedTickets);
        const categoryLabels = Object.keys(categoryDistribution);
        const categoryData = Object.values(categoryDistribution);
        
        // Priority distribution chart
        const priorityDistribution = utils.getPriorityDistribution(state.analyzedTickets);
        const priorityLabels = Object.keys(priorityDistribution);
        const priorityData = Object.values(priorityDistribution);
        
        // Colors for charts
        const categoryColors = [
          'rgba(79, 70, 229, 0.8)',
          'rgba(59, 130, 246, 0.8)',
          'rgba(16, 185, 129, 0.8)',
          'rgba(245, 158, 11, 0.8)',
          'rgba(239, 68, 68, 0.8)',
          'rgba(139, 92, 246, 0.8)',
          'rgba(236, 72, 153, 0.8)',
          'rgba(249, 115, 22, 0.8)',
          'rgba(6, 182, 212, 0.8)',
          'rgba(168, 85, 247, 0.8)'
        ];
        
        const priorityColors = {
          low: 'rgba(16, 185, 129, 0.8)',
          medium: 'rgba(245, 158, 11, 0.8)',
          high: 'rgba(239, 68, 68, 0.8)',
          critical: 'rgba(127, 29, 29, 0.8)'
        };
        
        // Destroy existing charts if they exist
        if (state.charts.categoryChart) {
          state.charts.categoryChart.destroy();
        }
        if (state.charts.priorityChart) {
          state.charts.priorityChart.destroy();
        }
        
        // Create category chart
        const categoryCtx = document.getElementById('category-chart').getContext('2d');
        state.charts.categoryChart = new Chart(categoryCtx, {
          type: 'doughnut',
          data: {
            labels: categoryLabels,
            datasets: [{
              data: categoryData,
              backgroundColor: categoryLabels.map((_, i) => categoryColors[i % categoryColors.length]),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  boxWidth: 12,
                  padding: 15
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    const percentage = ((value / categoryData.reduce((a, b) => a + b, 0)) * 100).toFixed(1);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
        
        // Create priority chart
        const priorityCtx = document.getElementById('priority-chart').getContext('2d');
        state.charts.priorityChart = new Chart(priorityCtx, {
          type: 'bar',
          data: {
            labels: priorityLabels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
            datasets: [{
              label: 'Tickets by Priority',
              data: priorityData,
              backgroundColor: priorityLabels.map(label => priorityColors[label]),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        });
      },
      
      // Update recent tickets table
      updateRecentTicketsTable: () => {
        if (state.analyzedTickets.length === 0) {
          elements.recentTicketsTable.innerHTML = `
            <tr>
              <td colspan="6" class="px-6 py-4 text-center text-gray-500">No recent tickets</td>
            </tr>
          `;
          return;
        }
        
        elements.recentTicketsTable.innerHTML = '';
        
        // Display up to 5 most recent tickets
        // Display up to 5 most recent tickets
        state.analyzedTickets.slice(0, 5).forEach(ticket => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.ticket_id}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.summary.slice(0, 40)}${ticket.summary.length > 40 ? '...' : ''}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.category}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full priority-${ticket.priority.toLowerCase()}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${utils.formatSentiment(ticket.sentiment)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button class="text-indigo-600 hover:text-indigo-900 view-ticket-details" data-ticket-id="${ticket.ticket_id}">View Details</button>
            </td>
          `;
          elements.recentTicketsTable.appendChild(row);
        });
        
        // Add event listeners to view ticket details buttons
        elements.recentTicketsTable.querySelectorAll('.view-ticket-details').forEach(button => {
          button.addEventListener('click', () => {
            const ticketId = button.getAttribute('data-ticket-id');
            const ticket = state.analyzedTickets.find(t => t.ticket_id === ticketId);
            if (ticket) {
              uiControllers.showTicketDetailModal(ticket);
            }
          });
        });
      },
      
      // Single ticket analysis controller
      initSingleTicketAnalysis: () => {
        elements.singleTicketForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!utils.validateForm(elements.singleTicketForm)) {
            return;
          }
          
          // Show loading state
          document.body.style.cursor = 'wait';
          elements.singleTicketForm.querySelector('button[type="submit"]').disabled = true;
          elements.singleTicketForm.querySelector('button[type="submit"]').innerHTML = `
            <div class="loading-spinner" style="width: 20px; height: 20px;"></div>
            Processing...
          `;
          
          try {
            const ticket = {
              subject: elements.ticketSubject.value,
              description: elements.ticketDescription.value
            };
            
            const useQuickAnalysis = elements.quickAnalysis.checked;
            
            // Analyze ticket
            const result = await apiService.analyzeTicket(ticket, useQuickAnalysis);
            
            // Update result display
            elements.resultCategory.textContent = result.category;
            utils.setPriorityBadge(elements.resultPriorityBadge, result.priority);
            utils.setSentimentMeter(
              elements.sentimentMeterFill,
              elements.sentimentMarker,
              elements.sentimentValue,
              result.sentiment
            );
            elements.resultSummary.textContent = result.summary;
            elements.resultResponse.textContent = result.suggested_response;
            elements.analysisMethod.textContent = useQuickAnalysis ? 'Quick analysis' : 'Full AI analysis';
            
            // Show results section
            elements.singleAnalysisResults.classList.remove('hidden');
            
            // Save current ticket for export
            state.currentTicket = result;
            
            // Update dashboard data
            uiControllers.refreshDashboard();
          } catch (error) {
            console.error('Analysis error:', error);
            utils.showNotification('error', 'Analysis Failed', error.message);
          } finally {
            // Reset loading state
            document.body.style.cursor = 'default';
            const submitButton = elements.singleTicketForm.querySelector('button[type="submit"]');
            submitButton.disabled = false;
            submitButton.innerHTML = 'Analyze Ticket';
          }
        });
        
        // Copy response button
        elements.copyResponse.addEventListener('click', () => {
          utils.copyToClipboard(elements.resultResponse.textContent);
        });
        
        // Export analysis button
        elements.exportAnalysis.addEventListener('click', () => {
          if (state.currentTicket) {
            utils.exportJson(state.currentTicket, 'ticket_analysis.json');
          }
        });
      },
      
      // Bulk analysis controller
      initBulkAnalysis: () => {
        // File input change handler
        elements.csvFile.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            const file = e.target.files[0];
            elements.selectedFilename.textContent = file.name;
            elements.fileSelected.classList.remove('hidden');
          } else {
            elements.fileSelected.classList.add('hidden');
          }
        });
        
        // Remove file button
        elements.removeFile.addEventListener('click', () => {
          elements.csvFile.value = '';
          elements.fileSelected.classList.add('hidden');
        });
        
        // Preview CSV button
        elements.previewCsv.addEventListener('click', async () => {
          if (!elements.csvFile.files.length) {
            utils.showNotification('warning', 'No File Selected', 'Please select a CSV file to preview');
            return;
          }
          
          const file = elements.csvFile.files[0];
          
          // Parse CSV file
          Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              if (results.errors.length > 0) {
                utils.showNotification('error', 'CSV Parsing Error', results.errors[0].message);
                return;
              }
              
              const data = results.data;
              const headers = results.meta.fields;
              
              // Update column selectors
              elements.subjectColumn.innerHTML = '<option value="">Select Column</option>';
              elements.descriptionColumn.innerHTML = '<option value="">Select Column</option>';
              elements.categoryColumn.innerHTML = '<option value="">None</option>';
              elements.priorityColumn.innerHTML = '<option value="">None</option>';
              
              headers.forEach(header => {
                const subjectOption = document.createElement('option');
                subjectOption.value = header;
                subjectOption.textContent = header;
                if (header.toLowerCase().includes('subject') || header.toLowerCase().includes('title')) {
                  subjectOption.selected = true;
                }
                elements.subjectColumn.appendChild(subjectOption);
                
                const descriptionOption = document.createElement('option');
                descriptionOption.value = header;
                descriptionOption.textContent = header;
                if (header.toLowerCase().includes('description') || header.toLowerCase().includes('body') || header.toLowerCase().includes('content')) {
                  descriptionOption.selected = true;
                }
                elements.descriptionColumn.appendChild(descriptionOption);
                
                const categoryOption = document.createElement('option');
                categoryOption.value = header;
                categoryOption.textContent = header;
                if (header.toLowerCase().includes('category') || header.toLowerCase().includes('type')) {
                  categoryOption.selected = true;
                }
                elements.categoryColumn.appendChild(categoryOption);
                
                const priorityOption = document.createElement('option');
                priorityOption.value = header;
                priorityOption.textContent = header;
                if (header.toLowerCase().includes('priority') || header.toLowerCase().includes('severity')) {
                  priorityOption.selected = true;
                }
                elements.priorityColumn.appendChild(priorityOption);
              });
              
              // Populate preview table headers
              elements.csvPreviewHeaders.innerHTML = `
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Row</th>
                ${headers.map(header => `<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header}</th>`).join('')}
              `;
              
              // Populate preview table rows (first 5 only)
              elements.csvPreviewRows.innerHTML = '';
              data.slice(0, 5).forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tr.innerHTML = `
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                  ${headers.map(header => `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row[header] || ''}</td>`).join('')}
                `;
                elements.csvPreviewRows.appendChild(tr);
              });
              
              // Show preview modal
              elements.csvPreviewModal.classList.remove('hidden');
            }
          });
        });
        
        // Close CSV preview
        elements.closeCsvPreview.addEventListener('click', () => {
          elements.csvPreviewModal.classList.add('hidden');
        });
        
        // Confirm CSV mapping
        elements.confirmCsvMapping.addEventListener('click', () => {
          elements.csvPreviewModal.classList.add('hidden');
        });
        
        // CSV upload form submit
        elements.csvUploadForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!elements.csvFile.files.length) {
            utils.showNotification('warning', 'No File Selected', 'Please select a CSV file to process');
            return;
          }
          
          if (!elements.subjectColumn.value || !elements.descriptionColumn.value) {
            utils.showNotification('warning', 'Column Mapping Required', 'Please select the subject and description columns');
            return;
          }
          
          // Prepare form data
          const formData = new FormData();
          formData.append('file', elements.csvFile.files[0]);
          formData.append('subject_col', elements.subjectColumn.value);
          formData.append('description_col', elements.descriptionColumn.value);
          
          if (elements.categoryColumn.value) {
            formData.append('category_col', elements.categoryColumn.value);
          }
          
          if (elements.priorityColumn.value) {
            formData.append('priority_col', elements.priorityColumn.value);
          }
          
          try {
            // Show processing status
            elements.bulkProcessingStatus.classList.remove('hidden');
            elements.processingStatusMessage.textContent = 'Uploading CSV file...';
            elements.progressBar.style.width = '0%';
            elements.progressPercentage.textContent = '0%';
            elements.progressCount.textContent = '0/0 tickets';
            elements.estimatedTime.textContent = 'Estimated completion time: Calculating...';
            
            // Upload CSV file
            const uploadResult = await apiService.uploadCsv(formData);
            
            if (uploadResult.tickets && uploadResult.tickets.length > 0) {
              elements.processingStatusMessage.textContent = 'Analyzing tickets...';
              elements.progressCount.textContent = `0/${uploadResult.tickets.length} tickets`;
              
              // Start polling processing status
              const statusInterval = setInterval(async () => {
                const status = await apiService.getProcessingStatus();
                
                if (status.is_processing) {
                  const percentage = Math.round((status.processed_tickets / status.total_tickets) * 100);
                  elements.progressBar.style.width = `${percentage}%`;
                  elements.progressPercentage.textContent = `${percentage}%`;
                  elements.progressCount.textContent = `${status.processed_tickets}/${status.total_tickets} tickets`;
                  
                  if (status.estimated_completion) {
                    elements.estimatedTime.textContent = `Estimated completion time: ${status.estimated_completion}`;
                  }
                } else if (status.processed_tickets > 0) {
                  // Processing complete
                  clearInterval(statusInterval);
                  elements.progressBar.style.width = '100%';
                  elements.progressPercentage.textContent = '100%';
                  elements.progressCount.textContent = `${status.processed_tickets}/${status.total_tickets} tickets`;
                  elements.estimatedTime.textContent = 'Processing complete!';
                  
                  // Display results
                  uiControllers.showBulkResults(state.bulkResults);
                }
              }, 1000);
              
              // Process tickets in bulk
              const useQuickAnalysis = elements.bulkQuickAnalysis.checked;
              const bulkResults = await apiService.bulkAnalyze(uploadResult.tickets, useQuickAnalysis);
              
              // Clear interval in case it hasn't been cleared yet
              clearInterval(statusInterval);
              
              // Display results
              uiControllers.showBulkResults(bulkResults);
            } else {
              utils.showNotification('error', 'No Tickets Found', 'No valid tickets found in the CSV file');
            }
          } catch (error) {
            console.error('CSV processing error:', error);
            utils.showNotification('error', 'Processing Failed', error.message);
          }
        });
        
        // Export bulk results
        elements.exportBulkResults.addEventListener('click', () => {
          if (state.bulkResults && state.bulkResults.length > 0) {
            utils.exportToCsv(state.bulkResults, 'bulk_analysis_results.csv');
          }
        });
        
        // View dashboard from bulk results
        elements.viewDashboardFromBulk.addEventListener('click', () => {
          // Add bulk results to analyzed tickets
          state.analyzedTickets = [...state.bulkResults, ...state.analyzedTickets];
          
          // Switch to dashboard tab
          elements.tabDashboard.click();
        });
      },
      
      // Show bulk analysis results
      showBulkResults: (results) => {
        if (!results || results.length === 0) {
          return;
        }
        
        // Update results summary
        elements.bulkResultsSummary.textContent = `${results.length} tickets analyzed`;
        
        // Clear table
        elements.bulkResultsTable.innerHTML = '';
        
        // Populate table with results
        results.forEach((ticket, index) => {
          const row = document.createElement('tr');
          row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.ticket_id}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.summary.slice(0, 40)}${ticket.summary.length > 40 ? '...' : ''}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.category}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full priority-${ticket.priority.toLowerCase()}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${utils.formatSentiment(ticket.sentiment)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button class="text-indigo-600 hover:text-indigo-900 view-bulk-ticket" data-index="${index}">View Details</button>
            </td>
          `;
          elements.bulkResultsTable.appendChild(row);
        });
        
        // Add event listeners to view ticket buttons
        elements.bulkResultsTable.querySelectorAll('.view-bulk-ticket').forEach(button => {
          button.addEventListener('click', () => {
            const index = parseInt(button.getAttribute('data-index'), 10);
            uiControllers.showTicketDetailModal(results[index]);
          });
        });
        
        // Show results section
        elements.bulkAnalysisResults.classList.remove('hidden');
        
        // Save results to state
        state.bulkResults = results;
      },
      
      // Show ticket detail modal
      showTicketDetailModal: (ticket) => {
        elements.detailModalTitle.textContent = `Ticket ${ticket.ticket_id}`;
        elements.detailSubject.textContent = ticket.summary;
        elements.detailDescription.textContent = ticket.analysis_details?.description || 'No description available';
        elements.detailCategory.textContent = ticket.category;
        utils.setPriorityBadge(elements.detailPriorityBadge, ticket.priority);
        elements.detailSentiment.textContent = `${utils.formatSentiment(ticket.sentiment)} (${ticket.sentiment < -0.3 ? 'Negative' : ticket.sentiment > 0.3 ? 'Positive' : 'Neutral'})`;
        elements.detailSummary.textContent = ticket.summary;
        elements.detailResponse.textContent = ticket.suggested_response;
        
        // Show modal
        elements.ticketDetailModal.classList.remove('hidden');
        
        // Copy response button
        elements.copyDetailResponse.addEventListener('click', () => {
          utils.copyToClipboard(ticket.suggested_response);
        });
      },
      
      // Training controller
      initTraining: () => {
        // File input change handler
        elements.trainingCsvFile.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            const file = e.target.files[0];
            elements.trainingSelectedFilename.textContent = file.name;
            elements.trainingFileSelected.classList.remove('hidden');
          } else {
            elements.trainingFileSelected.classList.add('hidden');
          }
        });
        
        // Remove file button
        elements.trainingRemoveFile.addEventListener('click', () => {
          elements.trainingCsvFile.value = '';
          elements.trainingFileSelected.classList.add('hidden');
        });
        
        // Add category button
        elements.addCategory.addEventListener('click', () => {
          const category = elements.newCategory.value.trim();
          if (category) {
            // Add category pill
            const pill = document.createElement('div');
            pill.className = 'bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm mr-2 mb-2 flex items-center';
            pill.innerHTML = `
              <span>${category}</span>
              <button type="button" class="ml-1 text-indigo-600 hover:text-indigo-900 remove-category">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            `;
            elements.categoriesContainer.appendChild(pill);
            
            // Add to categories list
            if (!state.categories.includes(category)) {
              state.categories.push(category);
            }
            
            // Clear input
            elements.newCategory.value = '';
            
            // Add remove event
            pill.querySelector('.remove-category').addEventListener('click', () => {
              elements.categoriesContainer.removeChild(pill);
              state.categories = state.categories.filter(c => c !== category);
            });
          }
        });
        
        // Preview training data
        elements.previewTrainingData.addEventListener('click', async () => {
          if (!elements.trainingCsvFile.files.length) {
            utils.showNotification('warning', 'No File Selected', 'Please select a CSV file to preview');
            return;
          }
          
          const file = elements.trainingCsvFile.files[0];
          
          // Parse CSV file
          Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              if (results.errors.length > 0) {
                utils.showNotification('error', 'CSV Parsing Error', results.errors[0].message);
                return;
              }
              
              const data = results.data;
              const headers = results.meta.fields;
              
              // Update column selectors
              elements.trainingSubjectColumn.innerHTML = '<option value="">Select Column</option>';
              elements.trainingDescriptionColumn.innerHTML = '<option value="">Select Column</option>';
              elements.trainingCategoryColumn.innerHTML = '<option value="">Select Column</option>';
              
              headers.forEach(header => {
                const subjectOption = document.createElement('option');
                subjectOption.value = header;
                subjectOption.textContent = header;
                if (header.toLowerCase().includes('subject') || header.toLowerCase().includes('title')) {
                  subjectOption.selected = true;
                }
                elements.trainingSubjectColumn.appendChild(subjectOption);
                
                const descriptionOption = document.createElement('option');
                descriptionOption.value = header;
                descriptionOption.textContent = header;
                if (header.toLowerCase().includes('description') || header.toLowerCase().includes('body') || header.toLowerCase().includes('content')) {
                  descriptionOption.selected = true;
                }
                elements.trainingDescriptionColumn.appendChild(descriptionOption);
                
                const categoryOption = document.createElement('option');
                categoryOption.value = header;
                categoryOption.textContent = header;
                if (header.toLowerCase().includes('category') || header.toLowerCase().includes('type')) {
                  categoryOption.selected = true;
                }
                elements.trainingCategoryColumn.appendChild(categoryOption);
              });
              
              // Populate preview table headers
              elements.csvPreviewHeaders.innerHTML = `
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Row</th>
                ${headers.map(header => `<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header}</th>`).join('')}
              `;
              
              // Populate preview table rows (first 5 only)
              elements.csvPreviewRows.innerHTML = '';
              data.slice(0, 5).forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tr.innerHTML = `
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                  ${headers.map(header => `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row[header] || ''}</td>`).join('')}
                `;
                elements.csvPreviewRows.appendChild(tr);
              });
              
              // Extract unique categories from data
              const categories = new Set();
              const categoryColumn = elements.trainingCategoryColumn.value;
              if (categoryColumn) {
                data.forEach(row => {
                  if (row[categoryColumn]) {
                    categories.add(row[categoryColumn]);
                  }
                });
              }
              
              // Add categories
              categories.forEach(category => {
                if (!state.categories.includes(category)) {
                  state.categories.push(category);
                  
                  const pill = document.createElement('div');
                  pill.className = 'bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm mr-2 mb-2 flex items-center';
                  pill.innerHTML = `
                    <span>${category}</span>
                    <button type="button" class="ml-1 text-indigo-600 hover:text-indigo-900 remove-category">
                      <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  `;
                  elements.categoriesContainer.appendChild(pill);
                  
                  // Add remove event
                  pill.querySelector('.remove-category').addEventListener('click', () => {
                    elements.categoriesContainer.removeChild(pill);
                    state.categories = state.categories.filter(c => c !== category);
                  });
                }
              });
              
              // Show preview modal
              elements.csvPreviewModal.classList.remove('hidden');
            }
          });
        });
        
        // Training form submit
        elements.trainingForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          let tickets = [];
          
          // If CSV file is selected, process it
          if (elements.trainingCsvFile.files.length > 0) {
            if (!elements.trainingSubjectColumn.value || !elements.trainingDescriptionColumn.value || !elements.trainingCategoryColumn.value) {
              utils.showNotification('warning', 'Column Mapping Required', 'Please select the subject, description, and category columns');
              return;
            }
            
            // Parse CSV file
            const file = elements.trainingCsvFile.files[0];
            
            // Show training status
            elements.trainingStatus.classList.remove('hidden');
            elements.trainingInProgress.classList.remove('hidden');
            elements.trainingComplete.classList.add('hidden');
            elements.trainingStatusMessage.textContent = 'Processing training data...';
            
            // Parse file
            try {
              await new Promise((resolve, reject) => {
                Papa.parse(file, {
                  header: true,
                  skipEmptyLines: true,
                  complete: function(results) {
                    if (results.errors.length > 0) {
                      reject(new Error(results.errors[0].message));
                      return;
                    }
                    
                    const data = results.data;
                    const subjectColumn = elements.trainingSubjectColumn.value;
                    const descriptionColumn = elements.trainingDescriptionColumn.value;
                    const categoryColumn = elements.trainingCategoryColumn.value;
                    
                    // Create tickets from CSV data
                    tickets = data.map(row => ({
                      subject: row[subjectColumn] || '',
                      description: row[descriptionColumn] || '',
                      category: row[categoryColumn] || ''
                    })).filter(ticket => ticket.subject && ticket.description && ticket.category);
                    
                    resolve();
                  },
                  error: function(error) {
                    reject(error);
                  }
                });
              });
            } catch (error) {
              utils.showNotification('error', 'CSV Parsing Error', error.message);
              return;
            }
          }
          
          // Make sure we have tickets and categories
          if (tickets.length === 0 && state.categories.length === 0) {
            utils.showNotification('warning', 'No Training Data', 'Please provide tickets with categories or define categories manually');
            return;
          }
          
          // Update training status
          elements.trainingStatusMessage.textContent = 'Training classifier...';
          
          try {
            // Prepare dataset
            const dataset = {
              tickets: tickets,
              categories: state.categories.length > 0 ? state.categories : null
            };
            
            // Train classifier
            const result = await apiService.trainClassifier(dataset);
            
            // Update training status
            elements.trainingInProgress.classList.add('hidden');
            elements.trainingComplete.classList.remove('hidden');
            elements.trainingStatusMessage.textContent = 'Training complete!';
            elements.trainedSamplesCount.textContent = tickets.length;
            elements.trainedCategoriesCount.textContent = result.categories.length;
            
            // Update categories list
            elements.trainedCategoriesList.innerHTML = '';
            result.categories.forEach(category => {
              const li = document.createElement('li');
              li.textContent = category;
              elements.trainedCategoriesList.appendChild(li);
            });
            
            // Update model info
            await apiService.getModelInfo();
          } catch (error) {
            console.error('Training error:', error);
            utils.showNotification('error', 'Training Failed', error.message);
            elements.trainingInProgress.classList.add('hidden');
            elements.trainingStatusMessage.textContent = `Training failed: ${error.message}`;
          }
        });
      },
      
      // Settings controller
      initSettings: () => {
        // Open settings modal
        elements.settingsButton.addEventListener('click', async () => {
          elements.settingsModal.classList.remove('hidden');
          
          try {
            // Get model info
            const modelInfo = await apiService.getModelInfo();
            
            // Update model selector
            elements.modelSelect.innerHTML = '';
            
            if (modelInfo.available_models && modelInfo.available_models.length > 0) {
              modelInfo.available_models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                if (model === modelInfo.model_name) {
                  option.selected = true;
                }
                elements.modelSelect.appendChild(option);
              });
            } else {
              const option = document.createElement('option');
              option.value = modelInfo.model_name;
              option.textContent = modelInfo.model_name;
              option.selected = true;
              elements.modelSelect.appendChild(option);
            }
            
            // Set Ollama URL
            elements.ollamaUrl.value = modelInfo.ollama_url;
          } catch (error) {
            console.error('Error loading model info:', error);
            utils.showNotification('error', 'Error', 'Failed to load model information');
          }
        });
        
        // Close settings modal
        elements.closeSettings.addEventListener('click', () => {
          elements.settingsModal.classList.add('hidden');
        });
        
        // Test connection button
        elements.testConnection.addEventListener('click', async () => {
          try {
            await apiService.checkConnection();
            utils.showNotification('success', 'Connection Successful', 'API connection is working properly');
          } catch (error) {
            utils.showNotification('error', 'Connection Failed', 'Failed to connect to API');
          }
        });
        
        // Settings form submit
        elements.settingsForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          // TODO: Implement saving settings (this would require backend API changes)
          elements.settingsModal.classList.add('hidden');
          utils.show<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enterprise Ticket Analysis System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .loading-spinner {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: #4F46E5;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .ticket-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .ticket-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .priority-low {
      background-color: #D1FAE5;
      color: #065F46;
    }

    .priority-medium {
      background-color: #FEF3C7;
      color: #92400E;
    }

    .priority-high {
      background-color: #FEE2E2;
      color: #B91C1C;
    }

    .priority-critical {
      background-color: #7F1D1D;
      color: #FEE2E2;
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #1F2937;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    /* Dashboard chart styles */
    .chart-container {
      height: 250px;
      width: 100%;
    }

    .sentiment-meter {
      width: 100%;
      height: 20px;
      background-color: #E5E7EB;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .sentiment-meter-fill {
      height: 100%;
      background: linear-gradient(to right, #EF4444, #F59E0B, #10B981);
      transition: width 0.5s ease;
    }

    .sentiment-marker {
      position: absolute;
      width: 4px;
      height: 24px;
      background-color: #374151;
      top: -2px;
      transform: translateX(-50%);
    }

    /* Custom tab styles */
    .tab-active {
      border-bottom: 2px solid #4F46E5;
      color: #4F46E5;
    }

    /* Responsive tables */
    @media (max-width: 768px) {
      .responsive-table {
        display: block;
        width: 100%;
        overflow-x: auto;
      }
    }

    /* Form validation styles */
    .input-error {
      border-color: #EF4444;
    }

    .error-message {
      color: #EF4444;
      font-size: 0.75rem;
      margin-top: 0.25rem;
    }
    
    /* Status indicator styles */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-active {
      background-color: #10B981;
      box-shadow: 0 0 5px #10B981;
    }
    
    .status-inactive {
      background-color: #6B7280;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <!-- Main navigation -->
  <nav class="bg-indigo-600 shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
          <span class="ml-2 text-white font-semibold text-xl">Enterprise Ticket Analysis System</span>
        </div>
        <div class="flex items-center">
          <div class="flex items-center mr-4">
            <div class="status-indicator status-active" id="api-status-indicator"></div>
            <span class="text-white text-sm" id="api-status">API Connected</span>
          </div>
          <div class="ml-4 flex items-center md:ml-6">
            <button id="settings-button" class="p-1 rounded-full text-gray-200 hover:text-white focus:outline-none">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Settings modal -->
  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-900">API Settings</h2>
        <button id="close-settings" class="text-gray-500 hover:text-gray-700">
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <form id="settings-form" class="space-y-4">
        <div>
          <label for="model-select" class="block text-sm font-medium text-gray-700">LLM Model</label>
          <select id="model-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            <option value="loading">Loading available models...</option>
          </select>
        </div>
        <div>
          <label for="ollama-url" class="block text-sm font-medium text-gray-700">Ollama API URL</label>
          <input type="text" id="ollama-url" name="ollama-url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="http://localhost:11434">
          <p class="mt-1 text-sm text-gray-500">Example: http://localhost:11434</p>
        </div>
        <div class="flex justify-end">
          <button type="button" id="test-connection" class="mr-2 bg-gray-100 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Test Connection
          </button>
          <button type="submit" class="bg-indigo-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Save Settings
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Main content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Tabs navigation -->
    <div class="border-b border-gray-200 mb-6">
      <nav class="flex -mb-px space-x-8">
        <a href="#" id="tab-dashboard" class="tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
          Dashboard
        </a>
        <a href="#" id="tab-single-analysis" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Single Ticket Analysis
        </a>
        <a href="#" id="tab-bulk-analysis" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Bulk Analysis
        </a>
        <a href="#" id="tab-training" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Classifier Training
        </a>
      </nav>
    </div>

    <!-- Dashboard tab content -->
    <div id="dashboard-content" class="tab-content">
      <!-- Stats cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Total Tickets</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="total-tickets">0</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Avg. Sentiment Score</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="avg-sentiment">0.0</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Avg. Processing Time</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="avg-time">0.0s</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Top Category</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="top-category">-</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Ticket Categories</h2>
            <div class="chart-container" id="category-chart-container">
              <canvas id="category-chart"></canvas>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Ticket Priorities</h2>
            <div class="chart-container" id="priority-chart-container">
              <canvas id="priority-chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent tickets -->
      <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">Recent Ticket Analysis</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 responsive-table">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentiment</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="recent-tickets-table">
                <tr>
                  <td colspan="6" class="px-6 py-4 text-center text-gray-500">No recent tickets</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Single Ticket Analysis tab content -->
    <div id="single-analysis-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Submit Ticket for Analysis</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Enter ticket details for AI-powered analysis</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="single-ticket-form" class="space-y-6">
            <div>
              <label for="ticket-subject" class="block text-sm font-medium text-gray-700">Subject</label>
              <div class="mt-1">
                <input type="text" name="ticket-subject" id="ticket-subject" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter ticket subject">
                <div class="error-message hidden" id="ticket-subject-error">Please enter a subject</div>
              </div>
            </div>

            <div>
              <label for="ticket-description" class="block text-sm font-medium text-gray-700">Description</label>
              <div class="mt-1">
                <textarea id="ticket-description" name="ticket-description" rows="5" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter ticket description"></textarea>
                <div class="error-message hidden" id="ticket-description-error">Please enter a description</div>
              </div>
            </div>

            <div class="flex items-center">
              <input id="quick-analysis" name="quick-analysis" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
              <label for="quick-analysis" class="ml-2 block text-sm text-gray-900">Use quick analysis mode (faster but less detailed)</label>
            </div>

            <div class="flex justify-end">
              <button type="submit" class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Analyze Ticket
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Analysis Results Section (initially hidden) -->
      <div id="single-analysis-results" class="hidden">
        <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
          <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
            <div>
              <h2 class="text-lg leading-6 font-medium text-gray-900">Analysis Results</h2>
              <p class="mt-1 max-w-2xl text-sm text-gray-500" id="analysis-method">Full AI analysis</p>
            </div>
            <div>
              <button id="export-analysis" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Export
              </button>
            </div>
          </div>

          <div class="border-t border-gray-200">
            <dl>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Category</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="result-category">-</dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Priority</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <span id="result-priority-badge" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">-</span>
                </dd>
              </div>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Sentiment Score</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div class="sentiment-meter">
                    <div id="sentiment-meter-fill" class="sentiment-meter-fill" style="width: 50%;"></div>
                    <div id="sentiment-marker" class="sentiment-marker" style="left: 50%;"></div>
                  </div>
                  <div class="flex justify-between mt-1">
                    <span class="text-xs text-red-600">Negative (-1.0)</span>
                    <span class="text-xs text-green-600">Positive (1.0)</span>
                  </div>
                  <div class="text-center text-xs mt-1" id="sentiment-value">0.0</div>
                </dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Summary</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="result-summary">-</dd>
              </div>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Suggested Response</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div id="result-response" class="prose max-w-none">-</div>
                  <div class="mt-2">
                    <button id="copy-response" class="inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                      </svg>
                      Copy Response
                    </button>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Bulk Analysis tab content -->
    <div id="bulk-analysis-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Bulk Ticket Upload</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Upload a CSV file containing multiple tickets</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="csv-upload-form" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700">CSV File</label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  <div class="flex text-sm text-gray-600">
                    <label for="csv-file" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                      <span>Upload a file</span>
                      <input id="csv-file" name="csv-file" type="file" accept=".csv" class="sr-only">
                    </label>
                    <p class="pl-1">or drag and drop</p>
                  </div>
                  <p class="text-xs text-gray-500">CSV up to 10MB</p>
                </div>
              </div>
              <div class="mt-2 hidden" id="file-selected">
                <div class="bg-gray-50 px-3 py-2 rounded-md flex items-center justify-between">
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span id="selected-filename" class="text-sm text-gray-600">filename.csv</span>
                  </div>
                  <button type="button" id="remove-file" class="text-gray-400 hover:text-gray-500">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">CSV Mapping</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="subject-column" class="block text-sm font-medium text-gray-700">Subject Column</label>
                  <select id="subject-column" name="subject-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="subject" selected>subject</option>
                  </select>
                </div>
                
                <div>
                  <label for="description-column" class="block text-sm font-medium text-gray-700">Description Column</label>
                  <select id="description-column" name="description-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="description" selected>description</option>
                  </select>
                </div>
                
                <div>
                  <label for="category-column" class="block text-sm font-medium text-gray-700">Category Column (optional)</label>
                  <select id="category-column" name="category-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">None</option>
                    <option value="category">category</option>
                  </select>
                </div>
                
                <div>
                  <label for="priority-column" class="block text-sm font-medium text-gray-700">Priority Column (optional)</label>
                  <select id="priority-column" name="priority-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">None</option>
                    <option value="priority">priority</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="flex items-center">
              <input id="bulk-quick-analysis" name="bulk-quick-analysis" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
              <label for="bulk-quick-analysis" class="ml-2 block text-sm text-gray-900">Use quick analysis mode (recommended for bulk processing)</label>
            </div>

            <div class="flex justify-end">
              <button type="button" id="preview-csv" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Preview Data
              </button>
              <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Process Tickets
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- CSV Preview Modal -->
      <div id="csv-preview-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full p-6 max-h-screen overflow-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900">CSV Preview</h2>
            <button id="close-csv-preview" class="text-gray-500 hover:text-gray-700">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr id="csv-preview-headers">
                  <!-- Headers will be populated dynamically -->
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="csv-preview-rows">
                <!-- Rows will be populated dynamically -->
              </tbody>
            </table>
          </div>
          <div class="mt-4 flex justify-end">
            <button id="confirm-csv-mapping" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Confirm Mapping
            </button>
          </div>
        </div>
      </div>

      <!-- Processing Status Section -->
      <div id="bulk-processing-status" class="hidden bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Processing Status</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500" id="processing-status-message">Analyzing tickets...</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <div class="relative pt-1">
            <div class="flex mb-2 items-center justify-between">
              <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-indigo-600 bg-indigo-200" id="progress-percentage">
                  0%
                </span>
              </div>
              <div class="text-right">
                <span class="text-xs font-semibold inline-block text-indigo-600" id="progress-count">
                  0/0 tickets
                </span>
              </div>
            </div>
            <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-indigo-200">
              <div id="progress-bar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-500" id="estimated-time">Estimated completion time: Calculating...</p>
          </div>
        </div>
      </div>

      <!-- Bulk Analysis Results Section -->
      <div id="bulk-analysis-results" class="hidden bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
          <div>
            <h2 class="text-lg leading-6 font-medium text-gray-900">Analysis Results</h2>
            <p class="mt-1 max-w-2xl text-sm text-gray-500" id="bulk-results-summary">0 tickets analyzed</p>
          </div>
          <div class="flex">
            <button id="export-bulk-results" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 mr-2">
              <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              Export CSV
            </button>
            <button id="view-dashboard-from-bulk" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              View Dashboard
            </button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 responsive-table">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentiment</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="bulk-results-table">
              <!-- Results will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ticket Detail Modal -->
      <div id="ticket-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full p-6 max-h-screen overflow-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900" id="detail-modal-title">Ticket Details</h2>
            <button id="close-ticket-detail" class="text-gray-500 hover:text-gray-700">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div>
            <dl class="divide-y divide-gray-200">
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Subject</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-subject">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Description</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-description">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Category</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-category">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Priority</dt>
                <dd class="mt-1 sm:mt-0 sm:col-span-2">
                  <span id="detail-priority-badge" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">-</span>
                </dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Sentiment</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-sentiment">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Summary</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-summary">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Suggested Response</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div id="detail-response" class="prose max-w-none">-</div>
                  <div class="mt-2">
                    <button id="copy-detail-response" class="inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                      </svg>
                      Copy Response
                    </button>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Classifier Training tab content -->
    <div id="training-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Train Category Classifier</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Upload categorized tickets to train the system</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="training-form" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700">Training Data</label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  <div class="flex text-sm text-gray-600">
                    <label for="training-csv-file" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                      <span>Upload a file</span>
                      <input id="training-csv-file" name="training-csv-file" type="file" accept=".csv" class="sr-only">
                    </label>
                    <p class="pl-1">or drag and drop</p>
                  </div>
                  <p class="text-xs text-gray-500">CSV with categorized tickets</p>
                </div>
              </div>
              <div class="mt-2 hidden" id="training-file-selected">
                <div class="bg-gray-50 px-3 py-2 rounded-md flex items-center justify-between">
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span id="training-selected-filename" class="text-sm text-gray-600">filename.csv</span>
                  </div>
                  <button type="button" id="training-remove-file" class="text-gray-400 hover:text-gray-500">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">CSV Mapping</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="training-subject-column" class="block text-sm font-medium text-gray-700">Subject Column</label>
                  <select id="training-subject-column" name="training-subject-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="subject" selected>subject</option>
                  </select>
                </div>
                
                <div>
                  <label for="training-description-column" class="block text-sm font-medium text-gray-700">Description Column</label>
                  <select id="training-description-column" name="training-description-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="description" selected>description</option>
                  </select>
                </div>
                
                <div>
                  <label for="training-category-column" class="block text-sm font-medium text-gray-700">Category Column</label>
                  <select id="training-category-column" name="training-category-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="category" selected>category</option>
                  </select>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">Or Add Categories Manually</h3>
              <div class="mt-2">
                <div class="flex items-center">
                  <input type="text" id="new-category" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter category name">
                  <button type="button" id="add-category" class="ml-2 inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                  </button>
                </div>
                <div class="mt-2 flex flex-wrap" id="categories-container">
                  <!-- Categories will be added here dynamically -->
                </div>
              </div>
            </div>

            <div class="flex justify-end">
              <button type="button" id="preview-training-data" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Preview Data
              </button>
              <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Train Classifier
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Training Status Card -->
      <div id="training-status" class="hidden bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Training Status</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500" id="training-status-message">Training in progress...</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <div id="training-in-progress" class="flex justify-center">
            <div class="loading-spinner"></div>
          </div>
          <div id="training-complete" class="hidden">
            <div class="bg-green-100 rounded-md p-4">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-green-800">Training complete</h3>
                                      <div class="mt-2 text-sm text-green-700">
                      <p>The classifier has been successfully trained with <span id="trained-samples-count">0</span> samples across <span id="trained-categories-count">0</span> categories.</p>
                      <ul class="mt-1 list-disc pl-5 space-y-1" id="trained-categories-list">
                        <!-- Categories will be added dynamically -->
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification component -->
  <div id="notification" class="fixed inset-0 flex items-end justify-center px-4 py-6 pointer-events-none sm:p-6 sm:items-start sm:justify-end z-50 hidden">
    <div class="max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto overflow-hidden">
      <div class="p-4">
        <div class="flex items-start">
          <div id="notification-icon" class="flex-shrink-0">
            <!-- Icon will be added dynamically based on notification type -->
          </div>
          <div class="ml-3 w-0 flex-1 pt-0.5">
            <p class="text-sm font-medium text-gray-900" id="notification-title">Notification Title</p>
            <p class="mt-1 text-sm text-gray-500" id="notification-message">Notification message here.</p>
          </div>
          <div class="ml-4 flex-shrink-0 flex">
            <button id="close-notification" class="bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              <span class="sr-only">Close</span>
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>

  <!-- Application JavaScript -->
  <script>
    // Global state
    const state = {
      apiBaseUrl: 'http://localhost:8000',
      tickets: [],
      analyzedTickets: [],
      categories: [],
      bulkResults: [],
      currentTicket: null,
      charts: {
        categoryChart: null,
        priorityChart: null,
      },
      processing: {
        isProcessing: false,
        total: 0,
        processed: 0,
        lastUpdate: null,
        estimatedCompletion: null
      },
      modelInfo: {
        modelName: '',
        ollamaUrl: '',
        availableModels: [],
        hasClassifier: false
      }
    };

    // DOM Elements
    const elements = {
      // Tab navigation
      tabDashboard: document.getElementById('tab-dashboard'),
      tabSingleAnalysis: document.getElementById('tab-single-analysis'),
      tabBulkAnalysis: document.getElementById('tab-bulk-analysis'),
      tabTraining: document.getElementById('tab-training'),
      
      // Tab content containers
      dashboardContent: document.getElementById('dashboard-content'),
      singleAnalysisContent: document.getElementById('single-analysis-content'),
      bulkAnalysisContent: document.getElementById('bulk-analysis-content'),
      trainingContent: document.getElementById('training-content'),
      
      // Dashboard elements
      totalTickets: document.getElementById('total-tickets'),
      avgSentiment: document.getElementById('avg-sentiment'),
      avgTime: document.getElementById('avg-time'),
      topCategory: document.getElementById('top-category'),
      recentTicketsTable: document.getElementById('recent-tickets-table'),
      
      // Single analysis elements
      singleTicketForm: document.getElementById('single-ticket-form'),
      ticketSubject: document.getElementById('ticket-subject'),
      ticketDescription: document.getElementById('ticket-description'),
      quickAnalysis: document.getElementById('quick-analysis'),
      singleAnalysisResults: document.getElementById('single-analysis-results'),
      resultCategory: document.getElementById('result-category'),
      resultPriorityBadge: document.getElementById('result-priority-badge'),
      sentimentMeterFill: document.getElementById('sentiment-meter-fill'),
      sentimentMarker: document.getElementById('sentiment-marker'),
      sentimentValue: document.getElementById('sentiment-value'),
      resultSummary: document.getElementById('result-summary'),
      resultResponse: document.getElementById('result-response'),
      copyResponse: document.getElementById('copy-response'),
      analysisMethod: document.getElementById('analysis-method'),
      exportAnalysis: document.getElementById('export-analysis'),
      
      // Bulk analysis elements
      csvUploadForm: document.getElementById('csv-upload-form'),
      csvFile: document.getElementById('csv-file'),
      fileSelected: document.getElementById('file-selected'),
      selectedFilename: document.getElementById('selected-filename'),
      removeFile: document.getElementById('remove-file'),
      subjectColumn: document.getElementById('subject-column'),
      descriptionColumn: document.getElementById('description-column'),
      categoryColumn: document.getElementById('category-column'),
      priorityColumn: document.getElementById('priority-column'),
      bulkQuickAnalysis: document.getElementById('bulk-quick-analysis'),
      previewCsv: document.getElementById('preview-csv'),
      bulkProcessingStatus: document.getElementById('bulk-processing-status'),
      progressPercentage: document.getElementById('progress-percentage'),
      progressCount: document.getElementById('progress-count'),
      progressBar: document.getElementById('progress-bar'),
      estimatedTime: document.getElementById('estimated-time'),
      processingStatusMessage: document.getElementById('processing-status-message'),
      bulkAnalysisResults: document.getElementById('bulk-analysis-results'),
      bulkResultsSummary: document.getElementById('bulk-results-summary'),
      bulkResultsTable: document.getElementById('bulk-results-table'),
      exportBulkResults: document.getElementById('export-bulk-results'),
      viewDashboardFromBulk: document.getElementById('view-dashboard-from-bulk'),
      
      // CSV Preview Modal
      csvPreviewModal: document.getElementById('csv-preview-modal'),
      closeCsvPreview: document.getElementById('close-csv-preview'),
      csvPreviewHeaders: document.getElementById('csv-preview-headers'),
      csvPreviewRows: document.getElementById('csv-preview-rows'),
      confirmCsvMapping: document.getElementById('confirm-csv-mapping'),
      
      // Ticket Detail Modal
      ticketDetailModal: document.getElementById('ticket-detail-modal'),
      closeTicketDetail: document.getElementById('close-ticket-detail'),
      detailModalTitle: document.getElementById('detail-modal-title'),
      detailSubject: document.getElementById('detail-subject'),
      detailDescription: document.getElementById('detail-description'),
      detailCategory: document.getElementById('detail-category'),
      detailPriorityBadge: document.getElementById('detail-priority-badge'),
      detailSentiment: document.getElementById('detail-sentiment'),
      detailSummary: document.getElementById('detail-summary'),
      detailResponse: document.getElementById('detail-response'),
      copyDetailResponse: document.getElementById('copy-detail-response'),
      
      // Training elements
      trainingForm: document.getElementById('training-form'),
      trainingCsvFile: document.getElementById('training-csv-file'),
      trainingFileSelected: document.getElementById('training-file-selected'),
      trainingSelectedFilename: document.getElementById('training-selected-filename'),
      trainingRemoveFile: document.getElementById('training-remove-file'),
      trainingSubjectColumn: document.getElementById('training-subject-column'),
      trainingDescriptionColumn: document.getElementById('training-description-column'),
      trainingCategoryColumn: document.getElementById('training-category-column'),
      newCategory: document.getElementById('new-category'),
      addCategory: document.getElementById('add-category'),
      categoriesContainer: document.getElementById('categories-container'),
      previewTrainingData: document.getElementById('preview-training-data'),
      trainingStatus: document.getElementById('training-status'),
      trainingStatusMessage: document.getElementById('training-status-message'),
      trainingInProgress: document.getElementById('training-in-progress'),
      trainingComplete: document.getElementById('training-complete'),
      trainedSamplesCount: document.getElementById('trained-samples-count'),
      trainedCategoriesCount: document.getElementById('trained-categories-count'),
      trainedCategoriesList: document.getElementById('trained-categories-list'),
      
      // Settings modal
      settingsButton: document.getElementById('settings-button'),
      settingsModal: document.getElementById('settings-modal'),
      closeSettings: document.getElementById('close-settings'),
      settingsForm: document.getElementById('settings-form'),
      modelSelect: document.getElementById('model-select'),
      ollamaUrl: document.getElementById('ollama-url'),
      testConnection: document.getElementById('test-connection'),
      
      // API status
      apiStatus: document.getElementById('api-status'),
      apiStatusIndicator: document.getElementById('api-status-indicator'),
      
      // Notification
      notification: document.getElementById('notification'),
      notificationIcon: document.getElementById('notification-icon'),
      notificationTitle: document.getElementById('notification-title'),
      notificationMessage: document.getElementById('notification-message'),
      closeNotification: document.getElementById('close-notification')
    };

    // Utility functions
    const utils = {
      // Format sentiment score
      formatSentiment: (score) => {
        return parseFloat(score).toFixed(2);
      },
      
      // Set priority badge color and text
      setPriorityBadge: (element, priority) => {
        element.textContent = priority.charAt(0).toUpperCase() + priority.slice(1);
        element.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full';
        
        switch (priority.toLowerCase()) {
          case 'low':
            element.classList.add('priority-low');
            break;
          case 'medium':
            element.classList.add('priority-medium');
            break;
          case 'high':
            element.classList.add('priority-high');
            break;
          case 'critical':
            element.classList.add('priority-critical');
            break;
          default:
            element.classList.add('bg-gray-100', 'text-gray-800');
        }
      },
      
      // Set sentiment meter display
      setSentimentMeter: (fillElement, markerElement, valueElement, score) => {
        // Convert score from -1...1 to 0...100
        const percentage = ((parseFloat(score) + 1) / 2) * 100;
        fillElement.style.width = `${percentage}%`;
        markerElement.style.left = `${percentage}%`;
        valueElement.textContent = utils.formatSentiment(score);
      },
      
      // Show notification
      showNotification: (type, title, message, duration = 4000) => {
        // Set icon based on notification type
        let iconSvg = '';
        switch (type) {
          case 'success':
            iconSvg = '<svg class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            break;
          case 'error':
            iconSvg = '<svg class="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            break;
          case 'warning':
            iconSvg = '<svg class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
            break;
          case 'info':
          default:
            iconSvg = '<svg class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
        }
        
        elements.notificationIcon.innerHTML = iconSvg;
        elements.notificationTitle.textContent = title;
        elements.notificationMessage.textContent = message;
        elements.notification.classList.remove('hidden');
        
        // Auto-hide after duration
        setTimeout(() => {
          elements.notification.classList.add('hidden');
        }, duration);
      },
      
      // Copy text to clipboard
      copyToClipboard: async (text) => {
        try {
          await navigator.clipboard.writeText(text);
          utils.showNotification('success', 'Copied!', 'Text copied to clipboard');
        } catch (err) {
          utils.showNotification('error', 'Copy Failed', 'Failed to copy text to clipboard');
          console.error('Failed to copy text: ', err);
        }
      },
      
      // Format date
      formatDate: (dateString) => {
        const date = new Date(dateString);
        return date.toLocaleString();
      },
      
      // Export JSON to file
      exportJson: (data, filename) => {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      },
      
      // Export data to CSV
      exportToCsv: (data, filename) => {
        // Convert data to CSV format
        const headers = Object.keys(data[0]).join(',');
        const rows = data.map(item => {
          return Object.values(item).map(value => {
            // Handle strings with commas by enclosing in quotes
            if (typeof value === 'string' && value.includes(',')) {
              return `"${value}"`;
            }
            return value;
          }).join(',');
        });
        
        const csv = [headers, ...rows].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      },
      
      // Validate form inputs
      validateForm: (form) => {
        let isValid = true;
        
        // Reset all error messages
        form.querySelectorAll('.error-message').forEach(element => {
          element.classList.add('hidden');
        });
        
        // Check required fields
        form.querySelectorAll('[required]').forEach(input => {
          if (!input.value.trim()) {
            const errorElement = document.getElementById(`${input.id}-error`);
            if (errorElement) {
              errorElement.classList.remove('hidden');
              input.classList.add('input-error');
            }
            isValid = false;
          } else {
            input.classList.remove('input-error');
          }
        });
        
        return isValid;
      },
      
      // Update API connection status display
      updateApiStatus: (isConnected, message = null) => {
        if (isConnected) {
          elements.apiStatus.textContent = message || 'API Connected';
          elements.apiStatusIndicator.classList.remove('status-inactive');
          elements.apiStatusIndicator.classList.add('status-active');
        } else {
          elements.apiStatus.textContent = message || 'API Disconnected';
          elements.apiStatusIndicator.classList.remove('status-active');
          elements.apiStatusIndicator.classList.add('status-inactive');
        }
      },
      
      // Get category distribution from tickets
      getCategoryDistribution: (tickets) => {
        const categories = {};
        tickets.forEach(ticket => {
          const category = ticket.category || 'Uncategorized';
          categories[category] = (categories[category] || 0) + 1;
        });
        return categories;
      },
      
      // Get priority distribution from tickets
      getPriorityDistribution: (tickets) => {
        const priorities = {
          low: 0,
          medium: 0,
          high: 0,
          critical: 0
        };
        
        tickets.forEach(ticket => {
          const priority = ticket.priority?.toLowerCase() || 'medium';
          if (priorities.hasOwnProperty(priority)) {
            priorities[priority]++;
          } else {
            priorities.medium++;
          }
        });
        
        return priorities;
      }
    };

    // API Service
    const apiService = {
      // Check API connection
      checkConnection: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/`);
          if (response.ok) {
            const data = await response.json();
            utils.updateApiStatus(true);
            return data;
          } else {
            utils.updateApiStatus(false);
            throw new Error('Failed to connect to API');
          }
        } catch (error) {
          utils.updateApiStatus(false, 'API Connection Failed');
          console.error('API connection error:', error);
          throw error;
        }
      },
      
      // Get model information
      getModelInfo: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/model_info`);
          if (response.ok) {
            const data = await response.json();
            state.modelInfo = data;
            return data;
          } else {
            throw new Error('Failed to get model information');
          }
        } catch (error) {
          console.error('Error getting model info:', error);
          utils.showNotification('error', 'Error', 'Failed to get model information');
          throw error;
        }
      },
      
      // Analyze a single ticket
      analyzeTicket: async (ticket, quick = false) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/analyze_ticket?quick=${quick}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(ticket),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.analyzedTickets.unshift(data);
            
            // Keep only the latest 20 tickets in history
            if (state.analyzedTickets.length > 20) {
              state.analyzedTickets = state.analyzedTickets.slice(0, 20);
            }
            
            return data;
          } else {
            throw new Error('Failed to analyze ticket');
          }
        } catch (error) {
          console.error('Error analyzing ticket:', error);
          utils.showNotification('error', 'Analysis Failed', `Failed to analyze ticket: ${error.message}`);
          throw error;
        }
      },
      
      // Upload and process CSV file
      uploadCsv: async (formData) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/upload_csv`, {
            method: 'POST',
            body: formData,
          });
          
          if (response.ok) {
            const data = await response.json();
            return data;
          } else {
            throw new Error('Failed to upload CSV file');
          }
        } catch (error) {
          console.error('Error uploading CSV:', error);
          utils.showNotification('error', 'Upload Failed', `Failed to upload CSV: ${error.message}`);
          throw error;
        }
      },
      
      // Process tickets in bulk
      bulkAnalyze: async (tickets, quick = true) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/bulk_analyze?quick=${quick}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(tickets),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.bulkResults = data;
            return data;
          } else {
            throw new Error('Failed to process tickets in bulk');
          }
        } catch (error) {
          console.error('Error in bulk analysis:', error);
          utils.showNotification('error', 'Bulk Analysis Failed', `Failed to analyze tickets: ${error.message}`);
          throw error;
        }
      },
      
      // Get processing status
      getProcessingStatus: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/processing_status`);
          if (response.ok) {
            const data = await response.json();
            state.processing = data;
            return data;
          } else {
            throw new Error('Failed to get processing status');
          }
        } catch (error) {
          console.error('Error getting processing status:', error);
          return state.processing;
        }
      },
      
      // Train classifier
      trainClassifier: async (dataset) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/train_classifier`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(dataset),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.categories = data.categories;
            return data;
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to train classifier');
          }
        } catch (error) {
          console.error('Error training classifier:', error);
          utils.showNotification('error', 'Training Failed', `Failed to train classifier: ${error.message}`);
          throw error;
        }
      }
    };

    // UI Controllers
    const uiControllers = {
      // Tab navigation controller
      initTabNavigation: () => {
        const tabs = [
          { tab: elements.tabDashboard, content: elements.dashboardContent },
          { tab: elements.tabSingleAnalysis, content: elements.singleAnalysisContent },
          { tab: elements.tabBulkAnalysis, content: elements.bulkAnalysisContent },
          { tab: elements.tabTraining, content: elements.trainingContent }
        ];
        
        tabs.forEach(({ tab, content }) => {
          tab.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Hide all tab contents
            tabs.forEach(t => {
              t.content.classList.add('hidden');
              t.tab.classList.remove('tab-active');
              t.tab.classList.add('text-gray-500', 'hover:text-gray-700', 'border-transparent');
            });
            
            // Show selected tab content
            content.classList.remove('hidden');
            tab.classList.add('tab-active');
            tab.classList.remove('text-gray-500', 'hover:text-gray-700', 'border-transparent');
            
            // Specific actions for tabs
            if (tab === elements.tabDashboard) {
              uiControllers.refreshDashboard();
            }
          });
        });
      },
      
      // Dashboard controller
      refreshDashboard: () => {
        // Update statistics
        elements.totalTickets.textContent = state.analyzedTickets.length;
        
        // Calculate average sentiment
        if (state.analyzedTickets.length > 0) {
          const sumSentiment = state.analyzedTickets.reduce((sum, ticket) => sum + ticket.sentiment, 0);
          const avgSentiment = sumSentiment / state.analyzedTickets.length;
          elements.avgSentiment.textContent = utils.formatSentiment(avgSentiment);
          
          // Find top category
          const categoryDistribution = utils.getCategoryDistribution(state.analyzedTickets);
          let topCategoryName = 'None';
          let topCategoryCount = 0;
          
          Object.entries(categoryDistribution).forEach(([category, count]) => {
            if (count > topCategoryCount) {
              topCategoryName = category;
              topCategoryCount = count;
            }
          });
          
          elements.topCategory.textContent = topCategoryName;
          
          // Update charts
          uiControllers.updateDashboardCharts();
          
          // Update recent tickets table
          uiControllers.updateRecentTicketsTable();
        }
      },
      
      // Update dashboard charts
      updateDashboardCharts: () => {
        // Category distribution chart
        const categoryDistribution = utils.getCategoryDistribution(state.analyzedTickets);
        const categoryLabels = Object.keys(categoryDistribution);
        const categoryData = Object.values(categoryDistribution);
        
        // Priority distribution chart
        const priorityDistribution = utils.getPriorityDistribution(state.analyzedTickets);
        const priorityLabels = Object.keys(priorityDistribution);
        const priorityData = Object.values(priorityDistribution);
        
        // Colors for charts
        const categoryColors = [
          'rgba(79, 70, 229, 0.8)',
          'rgba(59, 130, 246, 0.8)',
          'rgba(16, 185, 129, 0.8)',
          'rgba(245, 158, 11, 0.8)',
          'rgba(239, 68, 68, 0.8)',
          'rgba(139, 92, 246, 0.8)',
          'rgba(236, 72, 153, 0.8)',
          'rgba(249, 115, 22, 0.8)',
          'rgba(6, 182, 212, 0.8)',
          'rgba(168, 85, 247, 0.8)'
        ];
        
        const priorityColors = {
          low: 'rgba(16, 185, 129, 0.8)',
          medium: 'rgba(245, 158, 11, 0.8)',
          high: 'rgba(239, 68, 68, 0.8)',
          critical: 'rgba(127, 29, 29, 0.8)'
        };
        
        // Destroy existing charts if they exist
        if (state.charts.categoryChart) {
          state.charts.categoryChart.destroy();
        }
        if (state.charts.priorityChart) {
          state.charts.priorityChart.destroy();
        }
        
        // Create category chart
        const categoryCtx = document.getElementById('category-chart').getContext('2d');
        state.charts.categoryChart = new Chart(categoryCtx, {
          type: 'doughnut',
          data: {
            labels: categoryLabels,
            datasets: [{
              data: categoryData,
              backgroundColor: categoryLabels.map((_, i) => categoryColors[i % categoryColors.length]),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  boxWidth: 12,
                  padding: 15
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    const percentage = ((value / categoryData.reduce((a, b) => a + b, 0)) * 100).toFixed(1);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
        
        // Create priority chart
        const priorityCtx = document.getElementById('priority-chart').getContext('2d');
        state.charts.priorityChart = new Chart(priorityCtx, {
          type: 'bar',
          data: {
            labels: priorityLabels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
            datasets: [{
              label: 'Tickets by Priority',
              data: priorityData,
              backgroundColor: priorityLabels.map(label => priorityColors[label]),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        });
      },
      
      // Update recent tickets table
      updateRecentTicketsTable: () => {
        if (state.analyzedTickets.length === 0) {
          elements.recentTicketsTable.innerHTML = `
            <tr>
              <td colspan="6" class="px-6 py-4 text-center text-gray-500">No recent tickets</td>
            </tr>
          `;
          return;
        }
        
        elements.recentTicketsTable.innerHTML = '';
        
           // Display up to 5 most recent tickets
           // Display up to 5 most recent tickets
        state.analyzedTickets.slice(0, 5).forEach(ticket => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.ticket_id}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.summary.slice(0, 40)}${ticket.summary.length > 40 ? '...' : ''}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.category}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full priority-${ticket.priority.toLowerCase()}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${utils.formatSentiment(ticket.sentiment)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button class="text-indigo-600 hover:text-indigo-900 view-ticket-details" data-ticket-id="${ticket.ticket_id}">View Details</button>
            </td>
          `;
          elements.recentTicketsTable.appendChild(row);
        });
        
        // Add event listeners to view ticket details buttons
        elements.recentTicketsTable.querySelectorAll('.view-ticket-details').forEach(button => {
          button.addEventListener('click', () => {
            const ticketId = button.getAttribute('data-ticket-id');
            const ticket = state.analyzedTickets.find(t => t.ticket_id === ticketId);
            if (ticket) {
              uiControllers.showTicketDetailModal(ticket);
            }
          });
        });
      },
      
      // Single ticket analysis controller
      initSingleTicketAnalysis: () => {
        elements.singleTicketForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!utils.validateForm(elements.singleTicketForm)) {
            return;
          }
          
          // Show loading state
          document.body.style.cursor = 'wait';
          elements.singleTicketForm.querySelector('button[type="submit"]').disabled = true;
          elements.singleTicketForm.querySelector('button[type="submit"]').innerHTML = `
            <div class="loading-spinner" style="width: 20px; height: 20px;"></div>
            Processing...
          `;
          
          try {
            const ticket = {
              subject: elements.ticketSubject.value,
              description: elements.ticketDescription.value
            };
            
            const useQuickAnalysis = elements.quickAnalysis.checked;
            
            // Analyze ticket
            const result = await apiService.analyzeTicket(ticket, useQuickAnalysis);
            
            // Update result display
            elements.resultCategory.textContent = result.category;
            utils.setPriorityBadge(elements.resultPriorityBadge, result.priority);
            utils.setSentimentMeter(
              elements.sentimentMeterFill,
              elements.sentimentMarker,
              elements.sentimentValue,
              result.sentiment
            );
            elements.resultSummary.textContent = result.summary;
            elements.resultResponse.textContent = result.suggested_response;
            elements.analysisMethod.textContent = useQuickAnalysis ? 'Quick analysis' : 'Full AI analysis';
            
            // Show results section
            elements.singleAnalysisResults.classList.remove('hidden');
            
            // Save current ticket for export
            state.currentTicket = result;
            
            // Update dashboard data
            uiControllers.refreshDashboard();
          } catch (error) {
            console.error('Analysis error:', error);
            utils.showNotification('success', 'Settings Saved', 'API configuration has been updated');
        });
      },
      
      // Initialize UI components and event listeners
      initializeAll: () => {
        // Initialize tab navigation
        uiControllers.initTabNavigation();
        
        // Initialize single ticket analysis
        uiControllers.initSingleTicketAnalysis();
        
        // Initialize bulk analysis
        uiControllers.initBulkAnalysis();
        
        // Initialize training
        uiControllers.initTraining();
        
        // Initialize settings
        uiControllers.initSettings();
        
        // Close ticket detail modal
        elements.closeTicketDetail.addEventListener('click', () => {
          elements.ticketDetailModal.classList.add('hidden');
        });
        
        // Close notification
        elements.closeNotification.addEventListener('click', () => {
          elements.notification.classList.add('hidden');
        });
        
        // Close modals when clicking outside
        document.addEventListener('click', (e) => {
          if (e.target === elements.settingsModal) {
            elements.settingsModal.classList.add('hidden');
          }
          if (e.target === elements.ticketDetailModal) {
            elements.ticketDetailModal.classList.add('hidden');
          }
          if (e.target === elements.csvPreviewModal) {
            elements.csvPreviewModal.classList.add('hidden');
          }
        });
      }
    };

    // Initialize the application
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Check API connection
        await apiService.checkConnection();
        
        // Get model information
        await apiService.getModelInfo();
        
        // Initialize UI
        uiControllers.initializeAll();
        
        // Show dashboard (default view)
        elements.tabDashboard.click();
        
        // Show welcome notification
        utils.showNotification('info', 'Welcome', 'Enterprise Ticket Analysis System is ready to use');
      } catch (error) {
        console.error('Initialization error:', error);
        utils.updateApiStatus(false, 'API Connection Failed');
        utils.showNotification('error', 'Connection Error', 'Failed to connect to the API. Please check your configuration or try again later.');
      }
    });
  </script>
</body>
</html>Notification('error', 'Analysis Failed', error.message);
          } finally {
            // Reset loading state
            document.body.style.cursor = 'default';
            const submitButton = elements.singleTicketForm.querySelector('button[type="submit"]');
            submitButton.disabled = false;
            submitButton.innerHTML = 'Analyze Ticket';
          }
        });
        
        // Copy response button
        elements.copyResponse.addEventListener('click', () => {
          utils.copyToClipboard(elements.resultResponse.textContent);
        });
        
        // Export analysis button
        elements.exportAnalysis.addEventListener('click', () => {
          if (state.currentTicket) {
            utils.exportJson(state.currentTicket, 'ticket_analysis.json');
          }
        });
      },
      
      // Bulk analysis controller
      initBulkAnalysis: () => {
        // File input change handler
        elements.csvFile.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            const file = e.target.files[0];
            elements.selectedFilename.textContent = file.name;
            elements.fileSelected.classList.remove('hidden');
          } else {
            elements.fileSelected.classList.add('hidden');
          }
        });
        
        // Remove file button
        elements.removeFile.addEventListener('click', () => {
          elements.csvFile.value = '';
          elements.fileSelected.classList.add('hidden');
        });
        
        // Preview CSV button
        elements.previewCsv.addEventListener('click', async () => {
          if (!elements.csvFile.files.length) {
            utils.showNotification('warning', 'No File Selected', 'Please select a CSV file to preview');
            return;
          }
          
          const file = elements.csvFile.files[0];
          
          // Parse CSV file
          Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              if (results.errors.length > 0) {
                utils.showNotification('error', 'CSV Parsing Error', results.errors[0].message);
                return;
              }
              
              const data = results.data;
              const headers = results.meta.fields;
              
              // Update column selectors
              elements.subjectColumn.innerHTML = '<option value="">Select Column</option>';
              elements.descriptionColumn.innerHTML = '<option value="">Select Column</option>';
              elements.categoryColumn.innerHTML = '<option value="">None</option>';
              elements.priorityColumn.innerHTML = '<option value="">None</option>';
              
              headers.forEach(header => {
                const subjectOption = document.createElement('option');
                subjectOption.value = header;
                subjectOption.textContent = header;
                if (header.toLowerCase().includes('subject') || header.toLowerCase().includes('title')) {
                  subjectOption.selected = true;
                }
                elements.subjectColumn.appendChild(subjectOption);
                
                const descriptionOption = document.createElement('option');
                descriptionOption.value = header;
                descriptionOption.textContent = header;
                if (header.toLowerCase().includes('description') || header.toLowerCase().includes('body') || header.toLowerCase().includes('content')) {
                  descriptionOption.selected = true;
                }
                elements.descriptionColumn.appendChild(descriptionOption);
                
                const categoryOption = document.createElement('option');
                categoryOption.value = header;
                categoryOption.textContent = header;
                if (header.toLowerCase().includes('category') || header.toLowerCase().includes('type')) {
                  categoryOption.selected = true;
                }
                elements.categoryColumn.appendChild(categoryOption);
                
                const priorityOption = document.createElement('option');
                priorityOption.value = header;
                priorityOption.textContent = header;
                if (header.toLowerCase().includes('priority') || header.toLowerCase().includes('severity')) {
                  priorityOption.selected = true;
                }
                elements.priorityColumn.appendChild(priorityOption);
              });
              
              // Populate preview table headers
              elements.csvPreviewHeaders.innerHTML = `
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Row</th>
                ${headers.map(header => `<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header}</th>`).join('')}
              `;
              
              // Populate preview table rows (first 5 only)
              elements.csvPreviewRows.innerHTML = '';
              data.slice(0, 5).forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tr.innerHTML = `
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                  ${headers.map(header => `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row[header] || ''}</td>`).join('')}
                `;
                elements.csvPreviewRows.appendChild(tr);
              });
              
              // Show preview modal
              elements.csvPreviewModal.classList.remove('hidden');
            }
          });
        });
        
        // Close CSV preview
        elements.closeCsvPreview.addEventListener('click', () => {
          elements.csvPreviewModal.classList.add('hidden');
        });
        
        // Confirm CSV mapping
        elements.confirmCsvMapping.addEventListener('click', () => {
          elements.csvPreviewModal.classList.add('hidden');
        });
        
        // CSV upload form submit
        elements.csvUploadForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!elements.csvFile.files.length) {
            utils.showNotification('warning', 'No File Selected', 'Please select a CSV file to process');
            return;
          }
          
          if (!elements.subjectColumn.value || !elements.descriptionColumn.value) {
            utils.showNotification('warning', 'Column Mapping Required', 'Please select the subject and description columns');
            return;
          }
          
          // Prepare form data
          const formData = new FormData();
          formData.append('file', elements.csvFile.files[0]);
          formData.append('subject_col', elements.subjectColumn.value);
          formData.append('description_col', elements.descriptionColumn.value);
          
          if (elements.categoryColumn.value) {
            formData.append('category_col', elements.categoryColumn.value);
          }
          
          if (elements.priorityColumn.value) {
            formData.append('priority_col', elements.priorityColumn.value);
          }
          
          try {
            // Show processing status
            elements.bulkProcessingStatus.classList.remove('hidden');
            elements.processingStatusMessage.textContent = 'Uploading CSV file...';
            elements.progressBar.style.width = '0%';
            elements.progressPercentage.textContent = '0%';
            elements.progressCount.textContent = '0/0 tickets';
            elements.estimatedTime.textContent = 'Estimated completion time: Calculating...';
            
            // Upload CSV file
            const uploadResult = await apiService.uploadCsv(formData);
            
            if (uploadResult.tickets && uploadResult.tickets.length > 0) {
              elements.processingStatusMessage.textContent = 'Analyzing tickets...';
              elements.progressCount.textContent = `0/${uploadResult.tickets.length} tickets`;
              
              // Start polling processing status
              const statusInterval = setInterval(async () => {
                const status = await apiService.getProcessingStatus();
                
                if (status.is_processing) {
                  const percentage = Math.round((status.processed_tickets / status.total_tickets) * 100);
                  elements.progressBar.style.width = `${percentage}%`;
                  elements.progressPercentage.textContent = `${percentage}%`;
                  elements.progressCount.textContent = `${status.processed_tickets}/${status.total_tickets} tickets`;
                  
                  if (status.estimated_completion) {
                    elements.estimatedTime.textContent = `Estimated completion time: ${status.estimated_completion}`;
                  }
                } else if (status.processed_tickets > 0) {
                  // Processing complete
                  clearInterval(statusInterval);
                  elements.progressBar.style.width = '100%';
                  elements.progressPercentage.textContent = '100%';
                  elements.progressCount.textContent = `${status.processed_tickets}/${status.total_tickets} tickets`;
                  elements.estimatedTime.textContent = 'Processing complete!';
                  
                  // Display results
                  uiControllers.showBulkResults(state.bulkResults);
                }
              }, 1000);
              
              // Process tickets in bulk
              const useQuickAnalysis = elements.bulkQuickAnalysis.checked;
              const bulkResults = await apiService.bulkAnalyze(uploadResult.tickets, useQuickAnalysis);
              
              // Clear interval in case it hasn't been cleared yet
              clearInterval(statusInterval);
              
              // Display results
              uiControllers.showBulkResults(bulkResults);
            } else {
              utils.showNotification('error', 'No Tickets Found', 'No valid tickets found in the CSV file');
            }
          } catch (error) {
            console.error('CSV processing error:', error);
            utils.showNotification('error', 'Processing Failed', error.message);
          }
        });
        
        // Export bulk results
        elements.exportBulkResults.addEventListener('click', () => {
          if (state.bulkResults && state.bulkResults.length > 0) {
            utils.exportToCsv(state.bulkResults, 'bulk_analysis_results.csv');
          }
        });
        
        // View dashboard from bulk results
        elements.viewDashboardFromBulk.addEventListener('click', () => {
          // Add bulk results to analyzed tickets
          state.analyzedTickets = [...state.bulkResults, ...state.analyzedTickets];
          
          // Switch to dashboard tab
          elements.tabDashboard.click();
        });
      },
      
      // Show bulk analysis results
      showBulkResults: (results) => {
        if (!results || results.length === 0) {
          return;
        }
        
        // Update results summary
        elements.bulkResultsSummary.textContent = `${results.length} tickets analyzed`;
        
        // Clear table
        elements.bulkResultsTable.innerHTML = '';
        
        // Populate table with results
        results.forEach((ticket, index) => {
          const row = document.createElement('tr');
          row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${ticket.ticket_id}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.summary.slice(0, 40)}${ticket.summary.length > 40 ? '...' : ''}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ticket.category}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full priority-${ticket.priority.toLowerCase()}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${utils.formatSentiment(ticket.sentiment)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
              <button class="text-indigo-600 hover:text-indigo-900 view-bulk-ticket" data-index="${index}">View Details</button>
            </td>
          `;
          elements.bulkResultsTable.appendChild(row);
        });
        
        // Add event listeners to view ticket buttons
        elements.bulkResultsTable.querySelectorAll('.view-bulk-ticket').forEach(button => {
          button.addEventListener('click', () => {
            const index = parseInt(button.getAttribute('data-index'), 10);
            uiControllers.showTicketDetailModal(results[index]);
          });
        });
        
        // Show results section
        elements.bulkAnalysisResults.classList.remove('hidden');
        
        // Save results to state
        state.bulkResults = results;
      },
      
      // Show ticket detail modal
      showTicketDetailModal: (ticket) => {
        elements.detailModalTitle.textContent = `Ticket ${ticket.ticket_id}`;
        elements.detailSubject.textContent = ticket.summary;
        elements.detailDescription.textContent = ticket.analysis_details?.description || 'No description available';
        elements.detailCategory.textContent = ticket.category;
        utils.setPriorityBadge(elements.detailPriorityBadge, ticket.priority);
        elements.detailSentiment.textContent = `${utils.formatSentiment(ticket.sentiment)} (${ticket.sentiment < -0.3 ? 'Negative' : ticket.sentiment > 0.3 ? 'Positive' : 'Neutral'})`;
        elements.detailSummary.textContent = ticket.summary;
        elements.detailResponse.textContent = ticket.suggested_response;
        
        // Show modal
        elements.ticketDetailModal.classList.remove('hidden');
        
        // Copy response button
        elements.copyDetailResponse.addEventListener('click', () => {
          utils.copyToClipboard(ticket.suggested_response);
        });
      },
      
      // Training controller
      initTraining: () => {
        // File input change handler
        elements.trainingCsvFile.addEventListener('change', (e) => {
          if (e.target.files.length > 0) {
            const file = e.target.files[0];
            elements.trainingSelectedFilename.textContent = file.name;
            elements.trainingFileSelected.classList.remove('hidden');
          } else {
            elements.trainingFileSelected.classList.add('hidden');
          }
        });
        
        // Remove file button
        elements.trainingRemoveFile.addEventListener('click', () => {
          elements.trainingCsvFile.value = '';
          elements.trainingFileSelected.classList.add('hidden');
        });
        
        // Add category button
        elements.addCategory.addEventListener('click', () => {
          const category = elements.newCategory.value.trim();
          if (category) {
            // Add category pill
            const pill = document.createElement('div');
            pill.className = 'bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm mr-2 mb-2 flex items-center';
            pill.innerHTML = `
              <span>${category}</span>
              <button type="button" class="ml-1 text-indigo-600 hover:text-indigo-900 remove-category">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            `;
            elements.categoriesContainer.appendChild(pill);
            
            // Add to categories list
            if (!state.categories.includes(category)) {
              state.categories.push(category);
            }
            
            // Clear input
            elements.newCategory.value = '';
            
            // Add remove event
            pill.querySelector('.remove-category').addEventListener('click', () => {
              elements.categoriesContainer.removeChild(pill);
              state.categories = state.categories.filter(c => c !== category);
            });
          }
        });
        
        // Preview training data
        elements.previewTrainingData.addEventListener('click', async () => {
          if (!elements.trainingCsvFile.files.length) {
            utils.showNotification('warning', 'No File Selected', 'Please select a CSV file to preview');
            return;
          }
          
          const file = elements.trainingCsvFile.files[0];
          
          // Parse CSV file
          Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              if (results.errors.length > 0) {
                utils.showNotification('error', 'CSV Parsing Error', results.errors[0].message);
                return;
              }
              
              const data = results.data;
              const headers = results.meta.fields;
              
              // Update column selectors
              elements.trainingSubjectColumn.innerHTML = '<option value="">Select Column</option>';
              elements.trainingDescriptionColumn.innerHTML = '<option value="">Select Column</option>';
              elements.trainingCategoryColumn.innerHTML = '<option value="">Select Column</option>';
              
              headers.forEach(header => {
                const subjectOption = document.createElement('option');
                subjectOption.value = header;
                subjectOption.textContent = header;
                if (header.toLowerCase().includes('subject') || header.toLowerCase().includes('title')) {
                  subjectOption.selected = true;
                }
                elements.trainingSubjectColumn.appendChild(subjectOption);
                
                const descriptionOption = document.createElement('option');
                descriptionOption.value = header;
                descriptionOption.textContent = header;
                if (header.toLowerCase().includes('description') || header.toLowerCase().includes('body') || header.toLowerCase().includes('content')) {
                  descriptionOption.selected = true;
                }
                elements.trainingDescriptionColumn.appendChild(descriptionOption);
                
                const categoryOption = document.createElement('option');
                categoryOption.value = header;
                categoryOption.textContent = header;
                if (header.toLowerCase().includes('category') || header.toLowerCase().includes('type')) {
                  categoryOption.selected = true;
                }
                elements.trainingCategoryColumn.appendChild(categoryOption);
              });
              
              // Populate preview table headers
              elements.csvPreviewHeaders.innerHTML = `
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Row</th>
                ${headers.map(header => `<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header}</th>`).join('')}
              `;
              
              // Populate preview table rows (first 5 only)
              elements.csvPreviewRows.innerHTML = '';
              data.slice(0, 5).forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                tr.innerHTML = `
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                  ${headers.map(header => `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row[header] || ''}</td>`).join('')}
                `;
                elements.csvPreviewRows.appendChild(tr);
              });
              
              // Extract unique categories from data
              const categories = new Set();
              const categoryColumn = elements.trainingCategoryColumn.value;
              if (categoryColumn) {
                data.forEach(row => {
                  if (row[categoryColumn]) {
                    categories.add(row[categoryColumn]);
                  }
                });
              }
              
              // Add categories
              categories.forEach(category => {
                if (!state.categories.includes(category)) {
                  state.categories.push(category);
                  
                  const pill = document.createElement('div');
                  pill.className = 'bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full text-sm mr-2 mb-2 flex items-center';
                  pill.innerHTML = `
                    <span>${category}</span>
                    <button type="button" class="ml-1 text-indigo-600 hover:text-indigo-900 remove-category">
                      <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  `;
                  elements.categoriesContainer.appendChild(pill);
                  
                  // Add remove event
                  pill.querySelector('.remove-category').addEventListener('click', () => {
                    elements.categoriesContainer.removeChild(pill);
                    state.categories = state.categories.filter(c => c !== category);
                  });
                }
              });
              
              // Show preview modal
              elements.csvPreviewModal.classList.remove('hidden');
            }
          });
        });
        
        // Training form submit
        elements.trainingForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          let tickets = [];
          
          // If CSV file is selected, process it
          if (elements.trainingCsvFile.files.length > 0) {
            if (!elements.trainingSubjectColumn.value || !elements.trainingDescriptionColumn.value || !elements.trainingCategoryColumn.value) {
              utils.showNotification('warning', 'Column Mapping Required', 'Please select the subject, description, and category columns');
              return;
            }
            
            // Parse CSV file
            const file = elements.trainingCsvFile.files[0];
            
            // Show training status
            elements.trainingStatus.classList.remove('hidden');
            elements.trainingInProgress.classList.remove('hidden');
            elements.trainingComplete.classList.add('hidden');
            elements.trainingStatusMessage.textContent = 'Processing training data...';
            
            // Parse file
            try {
              await new Promise((resolve, reject) => {
                Papa.parse(file, {
                  header: true,
                  skipEmptyLines: true,
                  complete: function(results) {
                    if (results.errors.length > 0) {
                      reject(new Error(results.errors[0].message));
                      return;
                    }
                    
                    const data = results.data;
                    const subjectColumn = elements.trainingSubjectColumn.value;
                    const descriptionColumn = elements.trainingDescriptionColumn.value;
                    const categoryColumn = elements.trainingCategoryColumn.value;
                    
                    // Create tickets from CSV data
                    tickets = data.map(row => ({
                      subject: row[subjectColumn] || '',
                      description: row[descriptionColumn] || '',
                      category: row[categoryColumn] || ''
                    })).filter(ticket => ticket.subject && ticket.description && ticket.category);
                    
                    resolve();
                  },
                  error: function(error) {
                    reject(error);
                  }
                });
              });
            } catch (error) {
              utils.showNotification('error', 'CSV Parsing Error', error.message);
              return;
            }
          }
          
          // Make sure we have tickets and categories
          if (tickets.length === 0 && state.categories.length === 0) {
            utils.showNotification('warning', 'No Training Data', 'Please provide tickets with categories or define categories manually');
            return;
          }
          
          // Update training status
          elements.trainingStatusMessage.textContent = 'Training classifier...';
          
          try {
            // Prepare dataset
            const dataset = {
              tickets: tickets,
              categories: state.categories.length > 0 ? state.categories : null
            };
            
            // Train classifier
            const result = await apiService.trainClassifier(dataset);
            
            // Update training status
            elements.trainingInProgress.classList.add('hidden');
            elements.trainingComplete.classList.remove('hidden');
            elements.trainingStatusMessage.textContent = 'Training complete!';
            elements.trainedSamplesCount.textContent = tickets.length;
            elements.trainedCategoriesCount.textContent = result.categories.length;
            
            // Update categories list
            elements.trainedCategoriesList.innerHTML = '';
            result.categories.forEach(category => {
              const li = document.createElement('li');
              li.textContent = category;
              elements.trainedCategoriesList.appendChild(li);
            });
            
            // Update model info
            await apiService.getModelInfo();
          } catch (error) {
            console.error('Training error:', error);
            utils.showNotification('error', 'Training Failed', error.message);
            elements.trainingInProgress.classList.add('hidden');
            elements.trainingStatusMessage.textContent = `Training failed: ${error.message}`;
          }
        });
      },
      
      // Settings controller
      initSettings: () => {
        // Open settings modal
        elements.settingsButton.addEventListener('click', async () => {
          elements.settingsModal.classList.remove('hidden');
          
          try {
            // Get model info
            const modelInfo = await apiService.getModelInfo();
            
            // Update model selector
            elements.modelSelect.innerHTML = '';
            
            if (modelInfo.available_models && modelInfo.available_models.length > 0) {
              modelInfo.available_models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                if (model === modelInfo.model_name) {
                  option.selected = true;
                }
                elements.modelSelect.appendChild(option);
              });
            } else {
              const option = document.createElement('option');
              option.value = modelInfo.model_name;
              option.textContent = modelInfo.model_name;
              option.selected = true;
              elements.modelSelect.appendChild(option);
            }
            
            // Set Ollama URL
            elements.ollamaUrl.value = modelInfo.ollama_url;
          } catch (error) {
            console.error('Error loading model info:', error);
            utils.showNotification('error', 'Error', 'Failed to load model information');
          }
        });
        
        // Close settings modal
        elements.closeSettings.addEventListener('click', () => {
          elements.settingsModal.classList.add('hidden');
        });
        
        // Test connection button
        elements.testConnection.addEventListener('click', async () => {
          try {
            await apiService.checkConnection();
            utils.showNotification('success', 'Connection Successful', 'API connection is working properly');
          } catch (error) {
            utils.showNotification('error', 'Connection Failed', 'Failed to connect to API');
          }
        });
        
        // Settings form submit
        elements.settingsForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          // TODO: Implement saving settings (this would require backend API changes)
          elements.settingsModal.classList.add('hidden');
          utils.show<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enterprise Ticket Analysis System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .loading-spinner {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: #4F46E5;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .ticket-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .ticket-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    .priority-low {
      background-color: #D1FAE5;
      color: #065F46;
    }

    .priority-medium {
      background-color: #FEF3C7;
      color: #92400E;
    }

    .priority-high {
      background-color: #FEE2E2;
      color: #B91C1C;
    }

    .priority-critical {
      background-color: #7F1D1D;
      color: #FEE2E2;
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #1F2937;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    /* Dashboard chart styles */
    .chart-container {
      height: 250px;
      width: 100%;
    }

    .sentiment-meter {
      width: 100%;
      height: 20px;
      background-color: #E5E7EB;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .sentiment-meter-fill {
      height: 100%;
      background: linear-gradient(to right, #EF4444, #F59E0B, #10B981);
      transition: width 0.5s ease;
    }

    .sentiment-marker {
      position: absolute;
      width: 4px;
      height: 24px;
      background-color: #374151;
      top: -2px;
      transform: translateX(-50%);
    }

    /* Custom tab styles */
    .tab-active {
      border-bottom: 2px solid #4F46E5;
      color: #4F46E5;
    }

    /* Responsive tables */
    @media (max-width: 768px) {
      .responsive-table {
        display: block;
        width: 100%;
        overflow-x: auto;
      }
    }

    /* Form validation styles */
    .input-error {
      border-color: #EF4444;
    }

    .error-message {
      color: #EF4444;
      font-size: 0.75rem;
      margin-top: 0.25rem;
    }
    
    /* Status indicator styles */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-active {
      background-color: #10B981;
      box-shadow: 0 0 5px #10B981;
    }
    
    .status-inactive {
      background-color: #6B7280;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <!-- Main navigation -->
  <nav class="bg-indigo-600 shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <svg class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
          <span class="ml-2 text-white font-semibold text-xl">Enterprise Ticket Analysis System</span>
        </div>
        <div class="flex items-center">
          <div class="flex items-center mr-4">
            <div class="status-indicator status-active" id="api-status-indicator"></div>
            <span class="text-white text-sm" id="api-status">API Connected</span>
          </div>
          <div class="ml-4 flex items-center md:ml-6">
            <button id="settings-button" class="p-1 rounded-full text-gray-200 hover:text-white focus:outline-none">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Settings modal -->
  <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-900">API Settings</h2>
        <button id="close-settings" class="text-gray-500 hover:text-gray-700">
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <form id="settings-form" class="space-y-4">
        <div>
          <label for="model-select" class="block text-sm font-medium text-gray-700">LLM Model</label>
          <select id="model-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            <option value="loading">Loading available models...</option>
          </select>
        </div>
        <div>
          <label for="ollama-url" class="block text-sm font-medium text-gray-700">Ollama API URL</label>
          <input type="text" id="ollama-url" name="ollama-url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="http://localhost:11434">
          <p class="mt-1 text-sm text-gray-500">Example: http://localhost:11434</p>
        </div>
        <div class="flex justify-end">
          <button type="button" id="test-connection" class="mr-2 bg-gray-100 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Test Connection
          </button>
          <button type="submit" class="bg-indigo-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Save Settings
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Main content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Tabs navigation -->
    <div class="border-b border-gray-200 mb-6">
      <nav class="flex -mb-px space-x-8">
        <a href="#" id="tab-dashboard" class="tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
          Dashboard
        </a>
        <a href="#" id="tab-single-analysis" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Single Ticket Analysis
        </a>
        <a href="#" id="tab-bulk-analysis" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Bulk Analysis
        </a>
        <a href="#" id="tab-training" class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 border-transparent font-medium text-sm">
          Classifier Training
        </a>
      </nav>
    </div>

    <!-- Dashboard tab content -->
    <div id="dashboard-content" class="tab-content">
      <!-- Stats cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Total Tickets</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="total-tickets">0</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Avg. Sentiment Score</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="avg-sentiment">0.0</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Avg. Processing Time</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="avg-time">0.0s</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">Top Category</dt>
                  <dd class="flex items-baseline">
                    <div class="text-2xl font-semibold text-gray-900" id="top-category">-</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts row -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Ticket Categories</h2>
            <div class="chart-container" id="category-chart-container">
              <canvas id="category-chart"></canvas>
            </div>
          </div>
        </div>

        <div class="bg-white overflow-hidden shadow rounded-lg">
          <div class="px-4 py-5 sm:p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Ticket Priorities</h2>
            <div class="chart-container" id="priority-chart-container">
              <canvas id="priority-chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent tickets -->
      <div class="bg-white overflow-hidden shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">Recent Ticket Analysis</h2>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 responsive-table">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentiment</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="recent-tickets-table">
                <tr>
                  <td colspan="6" class="px-6 py-4 text-center text-gray-500">No recent tickets</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Single Ticket Analysis tab content -->
    <div id="single-analysis-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Submit Ticket for Analysis</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Enter ticket details for AI-powered analysis</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="single-ticket-form" class="space-y-6">
            <div>
              <label for="ticket-subject" class="block text-sm font-medium text-gray-700">Subject</label>
              <div class="mt-1">
                <input type="text" name="ticket-subject" id="ticket-subject" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter ticket subject">
                <div class="error-message hidden" id="ticket-subject-error">Please enter a subject</div>
              </div>
            </div>

            <div>
              <label for="ticket-description" class="block text-sm font-medium text-gray-700">Description</label>
              <div class="mt-1">
                <textarea id="ticket-description" name="ticket-description" rows="5" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter ticket description"></textarea>
                <div class="error-message hidden" id="ticket-description-error">Please enter a description</div>
              </div>
            </div>

            <div class="flex items-center">
              <input id="quick-analysis" name="quick-analysis" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
              <label for="quick-analysis" class="ml-2 block text-sm text-gray-900">Use quick analysis mode (faster but less detailed)</label>
            </div>

            <div class="flex justify-end">
              <button type="submit" class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Analyze Ticket
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Analysis Results Section (initially hidden) -->
      <div id="single-analysis-results" class="hidden">
        <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
          <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
            <div>
              <h2 class="text-lg leading-6 font-medium text-gray-900">Analysis Results</h2>
              <p class="mt-1 max-w-2xl text-sm text-gray-500" id="analysis-method">Full AI analysis</p>
            </div>
            <div>
              <button id="export-analysis" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Export
              </button>
            </div>
          </div>

          <div class="border-t border-gray-200">
            <dl>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Category</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="result-category">-</dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Priority</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <span id="result-priority-badge" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">-</span>
                </dd>
              </div>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Sentiment Score</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div class="sentiment-meter">
                    <div id="sentiment-meter-fill" class="sentiment-meter-fill" style="width: 50%;"></div>
                    <div id="sentiment-marker" class="sentiment-marker" style="left: 50%;"></div>
                  </div>
                  <div class="flex justify-between mt-1">
                    <span class="text-xs text-red-600">Negative (-1.0)</span>
                    <span class="text-xs text-green-600">Positive (1.0)</span>
                  </div>
                  <div class="text-center text-xs mt-1" id="sentiment-value">0.0</div>
                </dd>
              </div>
              <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Summary</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="result-summary">-</dd>
              </div>
              <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                <dt class="text-sm font-medium text-gray-500">Suggested Response</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div id="result-response" class="prose max-w-none">-</div>
                  <div class="mt-2">
                    <button id="copy-response" class="inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                      </svg>
                      Copy Response
                    </button>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Bulk Analysis tab content -->
    <div id="bulk-analysis-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Bulk Ticket Upload</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Upload a CSV file containing multiple tickets</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="csv-upload-form" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700">CSV File</label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  <div class="flex text-sm text-gray-600">
                    <label for="csv-file" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                      <span>Upload a file</span>
                      <input id="csv-file" name="csv-file" type="file" accept=".csv" class="sr-only">
                    </label>
                    <p class="pl-1">or drag and drop</p>
                  </div>
                  <p class="text-xs text-gray-500">CSV up to 10MB</p>
                </div>
              </div>
              <div class="mt-2 hidden" id="file-selected">
                <div class="bg-gray-50 px-3 py-2 rounded-md flex items-center justify-between">
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span id="selected-filename" class="text-sm text-gray-600">filename.csv</span>
                  </div>
                  <button type="button" id="remove-file" class="text-gray-400 hover:text-gray-500">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">CSV Mapping</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="subject-column" class="block text-sm font-medium text-gray-700">Subject Column</label>
                  <select id="subject-column" name="subject-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="subject" selected>subject</option>
                  </select>
                </div>
                
                <div>
                  <label for="description-column" class="block text-sm font-medium text-gray-700">Description Column</label>
                  <select id="description-column" name="description-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="description" selected>description</option>
                  </select>
                </div>
                
                <div>
                  <label for="category-column" class="block text-sm font-medium text-gray-700">Category Column (optional)</label>
                  <select id="category-column" name="category-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">None</option>
                    <option value="category">category</option>
                  </select>
                </div>
                
                <div>
                  <label for="priority-column" class="block text-sm font-medium text-gray-700">Priority Column (optional)</label>
                  <select id="priority-column" name="priority-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">None</option>
                    <option value="priority">priority</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="flex items-center">
              <input id="bulk-quick-analysis" name="bulk-quick-analysis" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" checked>
              <label for="bulk-quick-analysis" class="ml-2 block text-sm text-gray-900">Use quick analysis mode (recommended for bulk processing)</label>
            </div>

            <div class="flex justify-end">
              <button type="button" id="preview-csv" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Preview Data
              </button>
              <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Process Tickets
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- CSV Preview Modal -->
      <div id="csv-preview-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full p-6 max-h-screen overflow-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900">CSV Preview</h2>
            <button id="close-csv-preview" class="text-gray-500 hover:text-gray-700">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr id="csv-preview-headers">
                  <!-- Headers will be populated dynamically -->
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200" id="csv-preview-rows">
                <!-- Rows will be populated dynamically -->
              </tbody>
            </table>
          </div>
          <div class="mt-4 flex justify-end">
            <button id="confirm-csv-mapping" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Confirm Mapping
            </button>
          </div>
        </div>
      </div>

      <!-- Processing Status Section -->
      <div id="bulk-processing-status" class="hidden bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Processing Status</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500" id="processing-status-message">Analyzing tickets...</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <div class="relative pt-1">
            <div class="flex mb-2 items-center justify-between">
              <div>
                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-indigo-600 bg-indigo-200" id="progress-percentage">
                  0%
                </span>
              </div>
              <div class="text-right">
                <span class="text-xs font-semibold inline-block text-indigo-600" id="progress-count">
                  0/0 tickets
                </span>
              </div>
            </div>
            <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-indigo-200">
              <div id="progress-bar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-500" id="estimated-time">Estimated completion time: Calculating...</p>
          </div>
        </div>
      </div>

      <!-- Bulk Analysis Results Section -->
      <div id="bulk-analysis-results" class="hidden bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
          <div>
            <h2 class="text-lg leading-6 font-medium text-gray-900">Analysis Results</h2>
            <p class="mt-1 max-w-2xl text-sm text-gray-500" id="bulk-results-summary">0 tickets analyzed</p>
          </div>
          <div class="flex">
            <button id="export-bulk-results" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 mr-2">
              <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              Export CSV
            </button>
            <button id="view-dashboard-from-bulk" class="inline-flex items-center px-3 py-2 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              View Dashboard
            </button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 responsive-table">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sentiment</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="bulk-results-table">
              <!-- Results will be populated dynamically -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Ticket Detail Modal -->
      <div id="ticket-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full p-6 max-h-screen overflow-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-900" id="detail-modal-title">Ticket Details</h2>
            <button id="close-ticket-detail" class="text-gray-500 hover:text-gray-700">
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div>
            <dl class="divide-y divide-gray-200">
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Subject</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-subject">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Description</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-description">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Category</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-category">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Priority</dt>
                <dd class="mt-1 sm:mt-0 sm:col-span-2">
                  <span id="detail-priority-badge" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">-</span>
                </dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Sentiment</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-sentiment">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Summary</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="detail-summary">-</dd>
              </div>
              <div class="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4">
                <dt class="text-sm font-medium text-gray-500">Suggested Response</dt>
                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                  <div id="detail-response" class="prose max-w-none">-</div>
                  <div class="mt-2">
                    <button id="copy-detail-response" class="inline-flex items-center px-2.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                      </svg>
                      Copy Response
                    </button>
                  </div>
                </dd>
              </div>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <!-- Classifier Training tab content -->
    <div id="training-content" class="tab-content hidden">
      <div class="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Train Category Classifier</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Upload categorized tickets to train the system</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <form id="training-form" class="space-y-6">
            <div>
              <label class="block text-sm font-medium text-gray-700">Training Data</label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                  </svg>
                  <div class="flex text-sm text-gray-600">
                    <label for="training-csv-file" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                      <span>Upload a file</span>
                      <input id="training-csv-file" name="training-csv-file" type="file" accept=".csv" class="sr-only">
                    </label>
                    <p class="pl-1">or drag and drop</p>
                  </div>
                  <p class="text-xs text-gray-500">CSV with categorized tickets</p>
                </div>
              </div>
              <div class="mt-2 hidden" id="training-file-selected">
                <div class="bg-gray-50 px-3 py-2 rounded-md flex items-center justify-between">
                  <div class="flex items-center">
                    <svg class="h-5 w-5 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span id="training-selected-filename" class="text-sm text-gray-600">filename.csv</span>
                  </div>
                  <button type="button" id="training-remove-file" class="text-gray-400 hover:text-gray-500">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">CSV Mapping</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="training-subject-column" class="block text-sm font-medium text-gray-700">Subject Column</label>
                  <select id="training-subject-column" name="training-subject-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="subject" selected>subject</option>
                  </select>
                </div>
                
                <div>
                  <label for="training-description-column" class="block text-sm font-medium text-gray-700">Description Column</label>
                  <select id="training-description-column" name="training-description-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="description" selected>description</option>
                  </select>
                </div>
                
                <div>
                  <label for="training-category-column" class="block text-sm font-medium text-gray-700">Category Column</label>
                  <select id="training-category-column" name="training-category-column" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                    <option value="">Select Column</option>
                    <option value="category" selected>category</option>
                  </select>
                </div>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">Or Add Categories Manually</h3>
              <div class="mt-2">
                <div class="flex items-center">
                  <input type="text" id="new-category" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="Enter category name">
                  <button type="button" id="add-category" class="ml-2 inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                  </button>
                </div>
                <div class="mt-2 flex flex-wrap" id="categories-container">
                  <!-- Categories will be added here dynamically -->
                </div>
              </div>
            </div>

            <div class="flex justify-end">
              <button type="button" id="preview-training-data" class="mr-3 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Preview Data
              </button>
              <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Train Classifier
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Training Status Card -->
      <div id="training-status" class="hidden bg-white shadow overflow-hidden sm:rounded-lg">
        <div class="px-4 py-5 sm:px-6">
          <h2 class="text-lg leading-6 font-medium text-gray-900">Training Status</h2>
          <p class="mt-1 max-w-2xl text-sm text-gray-500" id="training-status-message">Training in progress...</p>
        </div>
        <div class="border-t border-gray-200 px-4 py-5 sm:p-6">
          <div id="training-in-progress" class="flex justify-center">
            <div class="loading-spinner"></div>
          </div>
          <div id="training-complete" class="hidden">
            <div class="bg-green-100 rounded-md p-4">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div class="ml-3">
                  <h3 class="text-sm font-medium text-green-800">Training complete</h3>
                                      <div class="mt-2 text-sm text-green-700">
                      <p>The classifier has been successfully trained with <span id="trained-samples-count">0</span> samples across <span id="trained-categories-count">0</span> categories.</p>
                      <ul class="mt-1 list-disc pl-5 space-y-1" id="trained-categories-list">
                        <!-- Categories will be added dynamically -->
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification component -->
  <div id="notification" class="fixed inset-0 flex items-end justify-center px-4 py-6 pointer-events-none sm:p-6 sm:items-start sm:justify-end z-50 hidden">
    <div class="max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto overflow-hidden">
      <div class="p-4">
        <div class="flex items-start">
          <div id="notification-icon" class="flex-shrink-0">
            <!-- Icon will be added dynamically based on notification type -->
          </div>
          <div class="ml-3 w-0 flex-1 pt-0.5">
            <p class="text-sm font-medium text-gray-900" id="notification-title">Notification Title</p>
            <p class="mt-1 text-sm text-gray-500" id="notification-message">Notification message here.</p>
          </div>
          <div class="ml-4 flex-shrink-0 flex">
            <button id="close-notification" class="bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              <span class="sr-only">Close</span>
              <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>

  <!-- Application JavaScript -->
  <script>
    // Global state
    const state = {
      apiBaseUrl: 'http://localhost:8000',
      tickets: [],
      analyzedTickets: [],
      categories: [],
      bulkResults: [],
      currentTicket: null,
      charts: {
        categoryChart: null,
        priorityChart: null,
      },
      processing: {
        isProcessing: false,
        total: 0,
        processed: 0,
        lastUpdate: null,
        estimatedCompletion: null
      },
      modelInfo: {
        modelName: '',
        ollamaUrl: '',
        availableModels: [],
        hasClassifier: false
      }
    };

    // DOM Elements
    const elements = {
      // Tab navigation
      tabDashboard: document.getElementById('tab-dashboard'),
      tabSingleAnalysis: document.getElementById('tab-single-analysis'),
      tabBulkAnalysis: document.getElementById('tab-bulk-analysis'),
      tabTraining: document.getElementById('tab-training'),
      
      // Tab content containers
      dashboardContent: document.getElementById('dashboard-content'),
      singleAnalysisContent: document.getElementById('single-analysis-content'),
      bulkAnalysisContent: document.getElementById('bulk-analysis-content'),
      trainingContent: document.getElementById('training-content'),
      
      // Dashboard elements
      totalTickets: document.getElementById('total-tickets'),
      avgSentiment: document.getElementById('avg-sentiment'),
      avgTime: document.getElementById('avg-time'),
      topCategory: document.getElementById('top-category'),
      recentTicketsTable: document.getElementById('recent-tickets-table'),
      
      // Single analysis elements
      singleTicketForm: document.getElementById('single-ticket-form'),
      ticketSubject: document.getElementById('ticket-subject'),
      ticketDescription: document.getElementById('ticket-description'),
      quickAnalysis: document.getElementById('quick-analysis'),
      singleAnalysisResults: document.getElementById('single-analysis-results'),
      resultCategory: document.getElementById('result-category'),
      resultPriorityBadge: document.getElementById('result-priority-badge'),
      sentimentMeterFill: document.getElementById('sentiment-meter-fill'),
      sentimentMarker: document.getElementById('sentiment-marker'),
      sentimentValue: document.getElementById('sentiment-value'),
      resultSummary: document.getElementById('result-summary'),
      resultResponse: document.getElementById('result-response'),
      copyResponse: document.getElementById('copy-response'),
      analysisMethod: document.getElementById('analysis-method'),
      exportAnalysis: document.getElementById('export-analysis'),
      
      // Bulk analysis elements
      csvUploadForm: document.getElementById('csv-upload-form'),
      csvFile: document.getElementById('csv-file'),
      fileSelected: document.getElementById('file-selected'),
      selectedFilename: document.getElementById('selected-filename'),
      removeFile: document.getElementById('remove-file'),
      subjectColumn: document.getElementById('subject-column'),
      descriptionColumn: document.getElementById('description-column'),
      categoryColumn: document.getElementById('category-column'),
      priorityColumn: document.getElementById('priority-column'),
      bulkQuickAnalysis: document.getElementById('bulk-quick-analysis'),
      previewCsv: document.getElementById('preview-csv'),
      bulkProcessingStatus: document.getElementById('bulk-processing-status'),
      progressPercentage: document.getElementById('progress-percentage'),
      progressCount: document.getElementById('progress-count'),
      progressBar: document.getElementById('progress-bar'),
      estimatedTime: document.getElementById('estimated-time'),
      processingStatusMessage: document.getElementById('processing-status-message'),
      bulkAnalysisResults: document.getElementById('bulk-analysis-results'),
      bulkResultsSummary: document.getElementById('bulk-results-summary'),
      bulkResultsTable: document.getElementById('bulk-results-table'),
      exportBulkResults: document.getElementById('export-bulk-results'),
      viewDashboardFromBulk: document.getElementById('view-dashboard-from-bulk'),
      
      // CSV Preview Modal
      csvPreviewModal: document.getElementById('csv-preview-modal'),
      closeCsvPreview: document.getElementById('close-csv-preview'),
      csvPreviewHeaders: document.getElementById('csv-preview-headers'),
      csvPreviewRows: document.getElementById('csv-preview-rows'),
      confirmCsvMapping: document.getElementById('confirm-csv-mapping'),
      
      // Ticket Detail Modal
      ticketDetailModal: document.getElementById('ticket-detail-modal'),
      closeTicketDetail: document.getElementById('close-ticket-detail'),
      detailModalTitle: document.getElementById('detail-modal-title'),
      detailSubject: document.getElementById('detail-subject'),
      detailDescription: document.getElementById('detail-description'),
      detailCategory: document.getElementById('detail-category'),
      detailPriorityBadge: document.getElementById('detail-priority-badge'),
      detailSentiment: document.getElementById('detail-sentiment'),
      detailSummary: document.getElementById('detail-summary'),
      detailResponse: document.getElementById('detail-response'),
      copyDetailResponse: document.getElementById('copy-detail-response'),
      
      // Training elements
      trainingForm: document.getElementById('training-form'),
      trainingCsvFile: document.getElementById('training-csv-file'),
      trainingFileSelected: document.getElementById('training-file-selected'),
      trainingSelectedFilename: document.getElementById('training-selected-filename'),
      trainingRemoveFile: document.getElementById('training-remove-file'),
      trainingSubjectColumn: document.getElementById('training-subject-column'),
      trainingDescriptionColumn: document.getElementById('training-description-column'),
      trainingCategoryColumn: document.getElementById('training-category-column'),
      newCategory: document.getElementById('new-category'),
      addCategory: document.getElementById('add-category'),
      categoriesContainer: document.getElementById('categories-container'),
      previewTrainingData: document.getElementById('preview-training-data'),
      trainingStatus: document.getElementById('training-status'),
      trainingStatusMessage: document.getElementById('training-status-message'),
      trainingInProgress: document.getElementById('training-in-progress'),
      trainingComplete: document.getElementById('training-complete'),
      trainedSamplesCount: document.getElementById('trained-samples-count'),
      trainedCategoriesCount: document.getElementById('trained-categories-count'),
      trainedCategoriesList: document.getElementById('trained-categories-list'),
      
      // Settings modal
      settingsButton: document.getElementById('settings-button'),
      settingsModal: document.getElementById('settings-modal'),
      closeSettings: document.getElementById('close-settings'),
      settingsForm: document.getElementById('settings-form'),
      modelSelect: document.getElementById('model-select'),
      ollamaUrl: document.getElementById('ollama-url'),
      testConnection: document.getElementById('test-connection'),
      
      // API status
      apiStatus: document.getElementById('api-status'),
      apiStatusIndicator: document.getElementById('api-status-indicator'),
      
      // Notification
      notification: document.getElementById('notification'),
      notificationIcon: document.getElementById('notification-icon'),
      notificationTitle: document.getElementById('notification-title'),
      notificationMessage: document.getElementById('notification-message'),
      closeNotification: document.getElementById('close-notification')
    };

    // Utility functions
    const utils = {
      // Format sentiment score
      formatSentiment: (score) => {
        return parseFloat(score).toFixed(2);
      },
      
      // Set priority badge color and text
      setPriorityBadge: (element, priority) => {
        element.textContent = priority.charAt(0).toUpperCase() + priority.slice(1);
        element.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full';
        
        switch (priority.toLowerCase()) {
          case 'low':
            element.classList.add('priority-low');
            break;
          case 'medium':
            element.classList.add('priority-medium');
            break;
          case 'high':
            element.classList.add('priority-high');
            break;
          case 'critical':
            element.classList.add('priority-critical');
            break;
          default:
            element.classList.add('bg-gray-100', 'text-gray-800');
        }
      },
      
      // Set sentiment meter display
      setSentimentMeter: (fillElement, markerElement, valueElement, score) => {
        // Convert score from -1...1 to 0...100
        const percentage = ((parseFloat(score) + 1) / 2) * 100;
        fillElement.style.width = `${percentage}%`;
        markerElement.style.left = `${percentage}%`;
        valueElement.textContent = utils.formatSentiment(score);
      },
      
      // Show notification
      showNotification: (type, title, message, duration = 4000) => {
        // Set icon based on notification type
        let iconSvg = '';
        switch (type) {
          case 'success':
            iconSvg = '<svg class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            break;
          case 'error':
            iconSvg = '<svg class="h-6 w-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            break;
          case 'warning':
            iconSvg = '<svg class="h-6 w-6 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
            break;
          case 'info':
          default:
            iconSvg = '<svg class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
        }
        
        elements.notificationIcon.innerHTML = iconSvg;
        elements.notificationTitle.textContent = title;
        elements.notificationMessage.textContent = message;
        elements.notification.classList.remove('hidden');
        
        // Auto-hide after duration
        setTimeout(() => {
          elements.notification.classList.add('hidden');
        }, duration);
      },
      
      // Copy text to clipboard
      copyToClipboard: async (text) => {
        try {
          await navigator.clipboard.writeText(text);
          utils.showNotification('success', 'Copied!', 'Text copied to clipboard');
        } catch (err) {
          utils.showNotification('error', 'Copy Failed', 'Failed to copy text to clipboard');
          console.error('Failed to copy text: ', err);
        }
      },
      
      // Format date
      formatDate: (dateString) => {
        const date = new Date(dateString);
        return date.toLocaleString();
      },
      
      // Export JSON to file
      exportJson: (data, filename) => {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      },
      
      // Export data to CSV
      exportToCsv: (data, filename) => {
        // Convert data to CSV format
        const headers = Object.keys(data[0]).join(',');
        const rows = data.map(item => {
          return Object.values(item).map(value => {
            // Handle strings with commas by enclosing in quotes
            if (typeof value === 'string' && value.includes(',')) {
              return `"${value}"`;
            }
            return value;
          }).join(',');
        });
        
        const csv = [headers, ...rows].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      },
      
      // Validate form inputs
      validateForm: (form) => {
        let isValid = true;
        
        // Reset all error messages
        form.querySelectorAll('.error-message').forEach(element => {
          element.classList.add('hidden');
        });
        
        // Check required fields
        form.querySelectorAll('[required]').forEach(input => {
          if (!input.value.trim()) {
            const errorElement = document.getElementById(`${input.id}-error`);
            if (errorElement) {
              errorElement.classList.remove('hidden');
              input.classList.add('input-error');
            }
            isValid = false;
          } else {
            input.classList.remove('input-error');
          }
        });
        
        return isValid;
      },
      
      // Update API connection status display
      updateApiStatus: (isConnected, message = null) => {
        if (isConnected) {
          elements.apiStatus.textContent = message || 'API Connected';
          elements.apiStatusIndicator.classList.remove('status-inactive');
          elements.apiStatusIndicator.classList.add('status-active');
        } else {
          elements.apiStatus.textContent = message || 'API Disconnected';
          elements.apiStatusIndicator.classList.remove('status-active');
          elements.apiStatusIndicator.classList.add('status-inactive');
        }
      },
      
      // Get category distribution from tickets
      getCategoryDistribution: (tickets) => {
        const categories = {};
        tickets.forEach(ticket => {
          const category = ticket.category || 'Uncategorized';
          categories[category] = (categories[category] || 0) + 1;
        });
        return categories;
      },
      
      // Get priority distribution from tickets
      getPriorityDistribution: (tickets) => {
        const priorities = {
          low: 0,
          medium: 0,
          high: 0,
          critical: 0
        };
        
        tickets.forEach(ticket => {
          const priority = ticket.priority?.toLowerCase() || 'medium';
          if (priorities.hasOwnProperty(priority)) {
            priorities[priority]++;
          } else {
            priorities.medium++;
          }
        });
        
        return priorities;
      }
    };

    // API Service
    const apiService = {
      // Check API connection
      checkConnection: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/`);
          if (response.ok) {
            const data = await response.json();
            utils.updateApiStatus(true);
            return data;
          } else {
            utils.updateApiStatus(false);
            throw new Error('Failed to connect to API');
          }
        } catch (error) {
          utils.updateApiStatus(false, 'API Connection Failed');
          console.error('API connection error:', error);
          throw error;
        }
      },
      
      // Get model information
      getModelInfo: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/model_info`);
          if (response.ok) {
            const data = await response.json();
            state.modelInfo = data;
            return data;
          } else {
            throw new Error('Failed to get model information');
          }
        } catch (error) {
          console.error('Error getting model info:', error);
          utils.showNotification('error', 'Error', 'Failed to get model information');
          throw error;
        }
      },
      
      // Analyze a single ticket
      analyzeTicket: async (ticket, quick = false) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/analyze_ticket?quick=${quick}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(ticket),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.analyzedTickets.unshift(data);
            
            // Keep only the latest 20 tickets in history
            if (state.analyzedTickets.length > 20) {
              state.analyzedTickets = state.analyzedTickets.slice(0, 20);
            }
            
            return data;
          } else {
            throw new Error('Failed to analyze ticket');
          }
        } catch (error) {
          console.error('Error analyzing ticket:', error);
          utils.showNotification('error', 'Analysis Failed', `Failed to analyze ticket: ${error.message}`);
          throw error;
        }
      },
      
      // Upload and process CSV file
      uploadCsv: async (formData) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/upload_csv`, {
            method: 'POST',
            body: formData,
          });
          
          if (response.ok) {
            const data = await response.json();
            return data;
          } else {
            throw new Error('Failed to upload CSV file');
          }
        } catch (error) {
          console.error('Error uploading CSV:', error);
          utils.showNotification('error', 'Upload Failed', `Failed to upload CSV: ${error.message}`);
          throw error;
        }
      },
      
      // Process tickets in bulk
      bulkAnalyze: async (tickets, quick = true) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/bulk_analyze?quick=${quick}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(tickets),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.bulkResults = data;
            return data;
          } else {
            throw new Error('Failed to process tickets in bulk');
          }
        } catch (error) {
          console.error('Error in bulk analysis:', error);
          utils.showNotification('error', 'Bulk Analysis Failed', `Failed to analyze tickets: ${error.message}`);
          throw error;
        }
      },
      
      // Get processing status
      getProcessingStatus: async () => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/processing_status`);
          if (response.ok) {
            const data = await response.json();
            state.processing = data;
            return data;
          } else {
            throw new Error('Failed to get processing status');
          }
        } catch (error) {
          console.error('Error getting processing status:', error);
          return state.processing;
        }
      },
      
      // Train classifier
      trainClassifier: async (dataset) => {
        try {
          const response = await fetch(`${state.apiBaseUrl}/train_classifier`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(dataset),
          });
          
          if (response.ok) {
            const data = await response.json();
            state.categories = data.categories;
            return data;
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to train classifier');
          }
        } catch (error) {
          console.error('Error training classifier:', error);
          utils.showNotification('error', 'Training Failed', `Failed to train classifier: ${error.message}`);
          throw error;
        }
      }
    };

    // UI Controllers
    const uiControllers = {
      // Tab navigation controller
      initTabNavigation: () => {
        const tabs = [
          { tab: elements.tabDashboard, content: elements.dashboardContent },
          { tab: elements.tabSingleAnalysis, content: elements.singleAnalysisContent },
          { tab: elements.tabBulkAnalysis, content: elements.bulkAnalysisContent },
          { tab: elements.tabTraining, content: elements.trainingContent }
        ];
        
        tabs.forEach(({ tab, content }) => {
          tab.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Hide all tab contents
            tabs.forEach(t => {
              t.content.classList.add('hidden');
              t.tab.classList.remove('tab-active');
              t.tab.classList.add('text-gray-500', 'hover:text-gray-700', 'border-transparent');
            });
            
            // Show selected tab content
            content.classList.remove('hidden');
            tab.classList.add('tab-active');
            tab.classList.remove('text-gray-500', 'hover:text-gray-700', 'border-transparent');
            
            // Specific actions for tabs
            if (tab === elements.tabDashboard) {
              uiControllers.refreshDashboard();
            }
          });
        });
      },
      
      // Dashboard controller
      refreshDashboard: () => {
        // Update statistics
        elements.totalTickets.textContent = state.analyzedTickets.length;
        
        // Calculate average sentiment
        if (state.analyzedTickets.length > 0) {
          const sumSentiment = state.analyzedTickets.reduce((sum, ticket) => sum + ticket.sentiment, 0);
          const avgSentiment = sumSentiment / state.analyzedTickets.length;
          elements.avgSentiment.textContent = utils.formatSentiment(avgSentiment);
          
          // Find top category
          const categoryDistribution = utils.getCategoryDistribution(state.analyzedTickets);
          let topCategoryName = 'None';
          let topCategoryCount = 0;
          
          Object.entries(categoryDistribution).forEach(([category, count]) => {
            if (count > topCategoryCount) {
              topCategoryName = category;
              topCategoryCount = count;
            }
          });
          
          elements.topCategory.textContent = topCategoryName;
          
          // Update charts
          uiControllers.updateDashboardCharts();
          
          // Update recent tickets table
          uiControllers.updateRecentTicketsTable();
        }
      },
      
      // Update dashboard charts
      updateDashboardCharts: () => {
        // Category distribution chart
        const categoryDistribution = utils.getCategoryDistribution(state.analyzedTickets);
        const categoryLabels = Object.keys(categoryDistribution);
        const categoryData = Object.values(categoryDistribution);
        
        // Priority distribution chart
        const priorityDistribution = utils.getPriorityDistribution(state.analyzedTickets);
        const priorityLabels = Object.keys(priorityDistribution);
        const priorityData = Object.values(priorityDistribution);
        
        // Colors for charts
        const categoryColors = [
          'rgba(79, 70, 229, 0.8)',
          'rgba(59, 130, 246, 0.8)',
          'rgba(16, 185, 129, 0.8)',
          'rgba(245, 158, 11, 0.8)',
          'rgba(239, 68, 68, 0.8)',
          'rgba(139, 92, 246, 0.8)',
          'rgba(236, 72, 153, 0.8)',
          'rgba(249, 115, 22, 0.8)',
          'rgba(6, 182, 212, 0.8)',
          'rgba(168, 85, 247, 0.8)'
        ];
        
        const priorityColors = {
          low: 'rgba(16, 185, 129, 0.8)',
          medium: 'rgba(245, 158, 11, 0.8)',
          high: 'rgba(239, 68, 68, 0.8)',
          critical: 'rgba(127, 29, 29, 0.8)'
        };
        
        // Destroy existing charts if they exist
        if (state.charts.categoryChart) {
          state.charts.categoryChart.destroy();
        }
        if (state.charts.priorityChart) {
          state.charts.priorityChart.destroy();
        }
        
        // Create category chart
        const categoryCtx = document.getElementById('category-chart').getContext('2d');
        state.charts.categoryChart = new Chart(categoryCtx, {
          type: 'doughnut',
          data: {
            labels: categoryLabels,
            datasets: [{
              data: categoryData,
              backgroundColor: categoryLabels.map((_, i) => categoryColors[i % categoryColors.length]),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  boxWidth: 12,
                  padding: 15
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    const percentage = ((value / categoryData.reduce((a, b) => a + b, 0)) * 100).toFixed(1);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
        
        // Create priority chart
        const priorityCtx = document.getElementById('priority-chart').getContext('2d');
        state.charts.priorityChart = new Chart(priorityCtx, {
          type: 'bar',
          data: {
            labels: priorityLabels.map(label => label.charAt(0).toUpperCase() + label.slice(1)),
            datasets: [{
              label: 'Tickets by Priority',
              data: priorityData,
              backgroundColor: priorityLabels.map(label => priorityColors[label]),
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        });
      },
      
      // Update recent tickets table
      updateRecentTicketsTable: () => {
        if (state.analyzedTickets.length === 0) {
          elements.recentTicketsTable.innerHTML = `
            <tr>
              <td colspan="6" class="px-6 py-4 text-center text-gray-500">No recent tickets</td>
            </tr>
          `;
          return;
        }
        
        elements.recentTicketsTable.innerHTML = '';
        
        // Display up to 5 most recent tickets